* CHARMM input file for Multi-Site lambda-dynamics
* generated by py_prep (JZV 02/2019) for ALF (RLH 01/2019)
*
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  Multi-Site Lambda Dynamics 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

set fnex = 5.5 
!!set sysname = BiCycle2
set builddir = prep
set box = ????
set temp = 298.15
set ligseg = lig
set resnum = 1

! perturbation variables
set nsites = 2 
set nsubs1 = 19 
set nsubs2 = 24 
set nblocks = 43 

bomblev -2

!! Read in toppar stream file
stream @builddir/toppar.str

read rtf append card name @builddir/core.rtf
read param flex append card name @builddir/full_ligand.prm

!! !! Reads coordinates and pdb file for the protein
!! read sequ pdb name @builddir/protein.pdb
!! generate SEGID first NTER last CTER setup warn
!! read coor pdb resid name @builddir/protein.pdb
!! 
!! ic generate
!! ic param
!! ic build 
!! hbuild sele hydrogen end
!! auto angle dihe

!! Reads coordinates and pdb file for the ligand
read sequ pdb name @builddir/core.pdb
generate @ligseg setup
read coor pdb resid name @builddir/core.pdb

!! Read in the ligand patch rtf files
read rtf append card name @builddir/site1_sub1_pres.rtf
read rtf append card name @builddir/site1_sub2_pres.rtf
read rtf append card name @builddir/site1_sub3_pres.rtf
read rtf append card name @builddir/site1_sub4_pres.rtf
read rtf append card name @builddir/site1_sub5_pres.rtf
read rtf append card name @builddir/site1_sub6_pres.rtf
read rtf append card name @builddir/site1_sub7_pres.rtf
read rtf append card name @builddir/site1_sub8_pres.rtf
read rtf append card name @builddir/site1_sub9_pres.rtf
read rtf append card name @builddir/site1_sub10_pres.rtf
read rtf append card name @builddir/site1_sub11_pres.rtf
read rtf append card name @builddir/site1_sub12_pres.rtf
read rtf append card name @builddir/site1_sub13_pres.rtf
read rtf append card name @builddir/site1_sub14_pres.rtf
read rtf append card name @builddir/site1_sub15_pres.rtf
read rtf append card name @builddir/site1_sub16_pres.rtf
read rtf append card name @builddir/site1_sub17_pres.rtf
read rtf append card name @builddir/site1_sub18_pres.rtf
read rtf append card name @builddir/site1_sub19_pres.rtf
read rtf append card name @builddir/site2_sub1_pres.rtf
read rtf append card name @builddir/site2_sub2_pres.rtf
read rtf append card name @builddir/site2_sub3_pres.rtf
read rtf append card name @builddir/site2_sub4_pres.rtf
read rtf append card name @builddir/site2_sub5_pres.rtf
read rtf append card name @builddir/site2_sub6_pres.rtf
read rtf append card name @builddir/site2_sub7_pres.rtf
read rtf append card name @builddir/site2_sub8_pres.rtf
read rtf append card name @builddir/site2_sub9_pres.rtf
read rtf append card name @builddir/site2_sub10_pres.rtf
read rtf append card name @builddir/site2_sub11_pres.rtf
read rtf append card name @builddir/site2_sub12_pres.rtf
read rtf append card name @builddir/site2_sub13_pres.rtf
read rtf append card name @builddir/site2_sub14_pres.rtf
read rtf append card name @builddir/site2_sub15_pres.rtf
read rtf append card name @builddir/site2_sub16_pres.rtf
read rtf append card name @builddir/site2_sub17_pres.rtf
read rtf append card name @builddir/site2_sub18_pres.rtf
read rtf append card name @builddir/site2_sub19_pres.rtf
read rtf append card name @builddir/site2_sub20_pres.rtf
read rtf append card name @builddir/site2_sub21_pres.rtf
read rtf append card name @builddir/site2_sub22_pres.rtf
read rtf append card name @builddir/site2_sub23_pres.rtf
read rtf append card name @builddir/site2_sub24_pres.rtf

!! Read in the ligand fragment pdb files
ic generate

patch p1_1 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub1_frag.pdb
ic param
ic build

patch p1_2 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub2_frag.pdb
ic param
ic build

patch p1_3 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub3_frag.pdb
ic param
ic build

patch p1_4 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub4_frag.pdb
ic param
ic build

patch p1_5 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub5_frag.pdb
ic param
ic build

patch p1_6 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub6_frag.pdb
ic param
ic build

patch p1_7 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub7_frag.pdb
ic param
ic build

patch p1_8 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub8_frag.pdb
ic param
ic build

patch p1_9 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub9_frag.pdb
ic param
ic build

patch p1_10 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub10_frag.pdb
ic param
ic build

patch p1_11 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub11_frag.pdb
ic param
ic build

patch p1_12 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub12_frag.pdb
ic param
ic build

patch p1_13 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub13_frag.pdb
ic param
ic build

patch p1_14 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub14_frag.pdb
ic param
ic build

patch p1_15 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub15_frag.pdb
ic param
ic build

patch p1_16 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub16_frag.pdb
ic param
ic build

patch p1_17 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub17_frag.pdb
ic param
ic build

patch p1_18 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub18_frag.pdb
ic param
ic build

patch p1_19 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub19_frag.pdb
ic param
ic build

patch p2_1 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub1_frag.pdb
ic param
ic build

patch p2_2 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub2_frag.pdb
ic param
ic build

patch p2_3 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub3_frag.pdb
ic param
ic build

patch p2_4 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub4_frag.pdb
ic param
ic build

patch p2_5 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub5_frag.pdb
ic param
ic build

patch p2_6 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub6_frag.pdb
ic param
ic build

patch p2_7 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub7_frag.pdb
ic param
ic build

patch p2_8 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub8_frag.pdb
ic param
ic build

patch p2_9 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub9_frag.pdb
ic param
ic build

patch p2_10 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub10_frag.pdb
ic param
ic build

patch p2_11 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub11_frag.pdb
ic param
ic build

patch p2_12 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub12_frag.pdb
ic param
ic build

patch p2_13 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub13_frag.pdb
ic param
ic build

patch p2_14 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub14_frag.pdb
ic param
ic build

patch p2_15 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub15_frag.pdb
ic param
ic build

patch p2_16 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub16_frag.pdb
ic param
ic build

patch p2_17 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub17_frag.pdb
ic param
ic build

patch p2_18 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub18_frag.pdb
ic param
ic build

patch p2_19 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub19_frag.pdb
ic param
ic build

patch p2_20 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub20_frag.pdb
ic param
ic build

patch p2_21 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub21_frag.pdb
ic param
ic build

patch p2_22 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub22_frag.pdb
ic param
ic build

patch p2_23 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub23_frag.pdb
ic param
ic build

patch p2_24 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub24_frag.pdb
ic param
ic build

!! Read in LonePair sites (if applicable)
stream @builddir/lpsites.inp

!! Define MSLD substituent selections
define site1_sub1 - 
   select ( - 
   atom @ligseg @resnum C006 .or. -
   atom @ligseg @resnum N007 .or. -
   atom @ligseg @resnum H008 .or. -
   atom @ligseg @resnum C009 .or. -
   atom @ligseg @resnum C010 .or. -
   atom @ligseg @resnum H011 .or. -
   atom @ligseg @resnum C012 .or. -
   atom @ligseg @resnum C013 .or. -
   atom @ligseg @resnum H014 .or. -
   atom @ligseg @resnum C015 .or. -
   atom @ligseg @resnum H016 .or. -
   atom @ligseg @resnum C017 .or. -
   atom @ligseg @resnum H018 .or. -
   atom @ligseg @resnum I019 .or. -
   atom @ligseg @resnum LP0A .or. -
   none ) end

define site1_sub2 - 
   select ( - 
   atom @ligseg @resnum C020 .or. -
   atom @ligseg @resnum N021 .or. -
   atom @ligseg @resnum H022 .or. -
   atom @ligseg @resnum C023 .or. -
   atom @ligseg @resnum C024 .or. -
   atom @ligseg @resnum F025 .or. -
   atom @ligseg @resnum C026 .or. -
   atom @ligseg @resnum F027 .or. -
   atom @ligseg @resnum C028 .or. -
   atom @ligseg @resnum H029 .or. -
   atom @ligseg @resnum C030 .or. -
   atom @ligseg @resnum H031 .or. -
   atom @ligseg @resnum C032 .or. -
   atom @ligseg @resnum H033 .or. -
   none ) end

define site1_sub3 - 
   select ( - 
   atom @ligseg @resnum C034 .or. -
   atom @ligseg @resnum N035 .or. -
   atom @ligseg @resnum H036 .or. -
   atom @ligseg @resnum C037 .or. -
   atom @ligseg @resnum C038 .or. -
   atom @ligseg @resnum H039 .or. -
   atom @ligseg @resnum C040 .or. -
   atom @ligseg @resnum Br0B .or. -
   atom @ligseg @resnum C041 .or. -
   atom @ligseg @resnum H042 .or. -
   atom @ligseg @resnum C043 .or. -
   atom @ligseg @resnum H044 .or. -
   atom @ligseg @resnum C045 .or. -
   atom @ligseg @resnum H046 .or. -
   atom @ligseg @resnum LP0C .or. -
   none ) end

define site1_sub4 - 
   select ( - 
   atom @ligseg @resnum C047 .or. -
   atom @ligseg @resnum N048 .or. -
   atom @ligseg @resnum H049 .or. -
   atom @ligseg @resnum N050 .or. -
   atom @ligseg @resnum H051 .or. -
   atom @ligseg @resnum C052 .or. -
   atom @ligseg @resnum C053 .or. -
   atom @ligseg @resnum H054 .or. -
   atom @ligseg @resnum C055 .or. -
   atom @ligseg @resnum Cl0D .or. -
   atom @ligseg @resnum C056 .or. -
   atom @ligseg @resnum F057 .or. -
   atom @ligseg @resnum C058 .or. -
   atom @ligseg @resnum H059 .or. -
   atom @ligseg @resnum C060 .or. -
   atom @ligseg @resnum H061 .or. -
   atom @ligseg @resnum LP0E .or. -
   none ) end

define site1_sub5 - 
   select ( - 
   atom @ligseg @resnum C062 .or. -
   atom @ligseg @resnum N063 .or. -
   atom @ligseg @resnum H064 .or. -
   atom @ligseg @resnum C065 .or. -
   atom @ligseg @resnum S066 .or. -
   atom @ligseg @resnum C067 .or. -
   atom @ligseg @resnum C068 .or. -
   atom @ligseg @resnum H069 .or. -
   atom @ligseg @resnum C070 .or. -
   atom @ligseg @resnum H071 .or. -
   atom @ligseg @resnum C072 .or. -
   atom @ligseg @resnum H073 .or. -
   atom @ligseg @resnum C074 .or. -
   atom @ligseg @resnum H075 .or. -
   atom @ligseg @resnum C076 .or. -
   atom @ligseg @resnum N077 .or. -
   none ) end

define site1_sub6 - 
   select ( - 
   atom @ligseg @resnum C078 .or. -
   atom @ligseg @resnum N079 .or. -
   atom @ligseg @resnum H080 .or. -
   atom @ligseg @resnum C081 .or. -
   atom @ligseg @resnum H082 .or. -
   atom @ligseg @resnum H083 .or. -
   atom @ligseg @resnum C084 .or. -
   atom @ligseg @resnum C085 .or. -
   atom @ligseg @resnum H086 .or. -
   atom @ligseg @resnum C087 .or. -
   atom @ligseg @resnum O088 .or. -
   atom @ligseg @resnum C089 .or. -
   atom @ligseg @resnum H090 .or. -
   atom @ligseg @resnum H091 .or. -
   atom @ligseg @resnum O092 .or. -
   atom @ligseg @resnum C093 .or. -
   atom @ligseg @resnum C094 .or. -
   atom @ligseg @resnum H095 .or. -
   atom @ligseg @resnum C096 .or. -
   atom @ligseg @resnum H097 .or. -
   none ) end

define site1_sub7 - 
   select ( - 
   atom @ligseg @resnum C098 .or. -
   atom @ligseg @resnum N099 .or. -
   atom @ligseg @resnum H100 .or. -
   atom @ligseg @resnum C101 .or. -
   atom @ligseg @resnum C102 .or. -
   atom @ligseg @resnum H103 .or. -
   atom @ligseg @resnum C104 .or. -
   atom @ligseg @resnum H105 .or. -
   atom @ligseg @resnum C106 .or. -
   atom @ligseg @resnum Br0F .or. -
   atom @ligseg @resnum C107 .or. -
   atom @ligseg @resnum H108 .or. -
   atom @ligseg @resnum C109 .or. -
   atom @ligseg @resnum H110 .or. -
   atom @ligseg @resnum LP0G .or. -
   none ) end

define site1_sub8 - 
   select ( - 
   atom @ligseg @resnum C111 .or. -
   atom @ligseg @resnum N112 .or. -
   atom @ligseg @resnum H113 .or. -
   atom @ligseg @resnum C114 .or. -
   atom @ligseg @resnum H115 .or. -
   atom @ligseg @resnum H116 .or. -
   atom @ligseg @resnum C117 .or. -
   atom @ligseg @resnum H118 .or. -
   atom @ligseg @resnum H119 .or. -
   atom @ligseg @resnum C120 .or. -
   atom @ligseg @resnum H121 .or. -
   atom @ligseg @resnum H122 .or. -
   atom @ligseg @resnum N123 .or. -
   atom @ligseg @resnum H124 .or. -
   atom @ligseg @resnum C125 .or. -
   atom @ligseg @resnum C126 .or. -
   atom @ligseg @resnum C127 .or. -
   atom @ligseg @resnum H128 .or. -
   atom @ligseg @resnum C129 .or. -
   atom @ligseg @resnum H130 .or. -
   atom @ligseg @resnum C131 .or. -
   atom @ligseg @resnum H132 .or. -
   atom @ligseg @resnum C133 .or. -
   atom @ligseg @resnum H134 .or. -
   atom @ligseg @resnum C135 .or. -
   atom @ligseg @resnum N136 .or. -
   atom @ligseg @resnum C137 .or. -
   atom @ligseg @resnum H138 .or. -
   atom @ligseg @resnum N139 .or. -
   none ) end

define site1_sub9 - 
   select ( - 
   atom @ligseg @resnum C140 .or. -
   atom @ligseg @resnum N141 .or. -
   atom @ligseg @resnum H142 .or. -
   atom @ligseg @resnum C143 .or. -
   atom @ligseg @resnum C144 .or. -
   atom @ligseg @resnum H145 .or. -
   atom @ligseg @resnum C146 .or. -
   atom @ligseg @resnum F147 .or. -
   atom @ligseg @resnum C148 .or. -
   atom @ligseg @resnum H149 .or. -
   atom @ligseg @resnum C150 .or. -
   atom @ligseg @resnum H151 .or. -
   atom @ligseg @resnum C152 .or. -
   atom @ligseg @resnum H153 .or. -
   none ) end

define site1_sub10 - 
   select ( - 
   atom @ligseg @resnum C154 .or. -
   atom @ligseg @resnum N155 .or. -
   atom @ligseg @resnum H156 .or. -
   atom @ligseg @resnum C157 .or. -
   atom @ligseg @resnum C158 .or. -
   atom @ligseg @resnum C159 .or. -
   atom @ligseg @resnum H160 .or. -
   atom @ligseg @resnum H161 .or. -
   atom @ligseg @resnum H162 .or. -
   atom @ligseg @resnum C163 .or. -
   atom @ligseg @resnum H164 .or. -
   atom @ligseg @resnum C165 .or. -
   atom @ligseg @resnum H166 .or. -
   atom @ligseg @resnum C167 .or. -
   atom @ligseg @resnum H168 .or. -
   atom @ligseg @resnum C169 .or. -
   atom @ligseg @resnum H170 .or. -
   none ) end

define site1_sub11 - 
   select ( - 
   atom @ligseg @resnum C171 .or. -
   atom @ligseg @resnum N172 .or. -
   atom @ligseg @resnum H173 .or. -
   atom @ligseg @resnum C174 .or. -
   atom @ligseg @resnum H175 .or. -
   atom @ligseg @resnum C176 .or. -
   atom @ligseg @resnum C177 .or. -
   atom @ligseg @resnum H178 .or. -
   atom @ligseg @resnum C179 .or. -
   atom @ligseg @resnum F180 .or. -
   atom @ligseg @resnum C181 .or. -
   atom @ligseg @resnum H182 .or. -
   atom @ligseg @resnum C183 .or. -
   atom @ligseg @resnum F184 .or. -
   atom @ligseg @resnum C185 .or. -
   atom @ligseg @resnum H186 .or. -
   atom @ligseg @resnum C187 .or. -
   atom @ligseg @resnum H188 .or. -
   atom @ligseg @resnum H189 .or. -
   atom @ligseg @resnum C190 .or. -
   atom @ligseg @resnum H191 .or. -
   atom @ligseg @resnum H192 .or. -
   atom @ligseg @resnum H193 .or. -
   none ) end

define site1_sub12 - 
   select ( - 
   atom @ligseg @resnum C194 .or. -
   atom @ligseg @resnum N195 .or. -
   atom @ligseg @resnum H196 .or. -
   atom @ligseg @resnum C197 .or. -
   atom @ligseg @resnum H198 .or. -
   atom @ligseg @resnum C199 .or. -
   atom @ligseg @resnum H200 .or. -
   atom @ligseg @resnum H201 .or. -
   atom @ligseg @resnum C202 .or. -
   atom @ligseg @resnum H203 .or. -
   atom @ligseg @resnum H204 .or. -
   atom @ligseg @resnum C205 .or. -
   atom @ligseg @resnum H206 .or. -
   atom @ligseg @resnum C207 .or. -
   atom @ligseg @resnum H208 .or. -
   atom @ligseg @resnum H209 .or. -
   atom @ligseg @resnum C210 .or. -
   atom @ligseg @resnum H211 .or. -
   atom @ligseg @resnum H212 .or. -
   atom @ligseg @resnum N213 .or. -
   atom @ligseg @resnum C214 .or. -
   atom @ligseg @resnum H215 .or. -
   atom @ligseg @resnum H216 .or. -
   atom @ligseg @resnum H217 .or. -
   atom @ligseg @resnum C218 .or. -
   atom @ligseg @resnum H219 .or. -
   atom @ligseg @resnum H220 .or. -
   atom @ligseg @resnum H221 .or. -
   none ) end

define site1_sub13 - 
   select ( - 
   atom @ligseg @resnum C222 .or. -
   atom @ligseg @resnum N223 .or. -
   atom @ligseg @resnum H224 .or. -
   atom @ligseg @resnum C225 .or. -
   atom @ligseg @resnum C226 .or. -
   atom @ligseg @resnum H227 .or. -
   atom @ligseg @resnum C228 .or. -
   atom @ligseg @resnum C229 .or. -
   atom @ligseg @resnum F230 .or. -
   atom @ligseg @resnum F231 .or. -
   atom @ligseg @resnum F232 .or. -
   atom @ligseg @resnum C233 .or. -
   atom @ligseg @resnum H234 .or. -
   atom @ligseg @resnum C235 .or. -
   atom @ligseg @resnum H236 .or. -
   atom @ligseg @resnum C237 .or. -
   atom @ligseg @resnum H238 .or. -
   none ) end

define site1_sub14 - 
   select ( - 
   atom @ligseg @resnum C239 .or. -
   atom @ligseg @resnum N240 .or. -
   atom @ligseg @resnum H241 .or. -
   atom @ligseg @resnum C242 .or. -
   atom @ligseg @resnum C243 .or. -
   atom @ligseg @resnum H244 .or. -
   atom @ligseg @resnum C245 .or. -
   atom @ligseg @resnum Cl0H .or. -
   atom @ligseg @resnum C246 .or. -
   atom @ligseg @resnum H247 .or. -
   atom @ligseg @resnum C248 .or. -
   atom @ligseg @resnum H249 .or. -
   atom @ligseg @resnum C250 .or. -
   atom @ligseg @resnum H251 .or. -
   atom @ligseg @resnum LP0I .or. -
   none ) end

define site1_sub15 - 
   select ( - 
   atom @ligseg @resnum C252 .or. -
   atom @ligseg @resnum N253 .or. -
   atom @ligseg @resnum H254 .or. -
   atom @ligseg @resnum C255 .or. -
   atom @ligseg @resnum C256 .or. -
   atom @ligseg @resnum H257 .or. -
   atom @ligseg @resnum C258 .or. -
   atom @ligseg @resnum Cl0J .or. -
   atom @ligseg @resnum C259 .or. -
   atom @ligseg @resnum H260 .or. -
   atom @ligseg @resnum C261 .or. -
   atom @ligseg @resnum H262 .or. -
   atom @ligseg @resnum C263 .or. -
   atom @ligseg @resnum C264 .or. -
   atom @ligseg @resnum H265 .or. -
   atom @ligseg @resnum H266 .or. -
   atom @ligseg @resnum H267 .or. -
   atom @ligseg @resnum LP0K .or. -
   none ) end

define site1_sub16 - 
   select ( - 
   atom @ligseg @resnum C268 .or. -
   atom @ligseg @resnum N269 .or. -
   atom @ligseg @resnum H270 .or. -
   atom @ligseg @resnum C271 .or. -
   atom @ligseg @resnum H272 .or. -
   atom @ligseg @resnum H273 .or. -
   atom @ligseg @resnum C274 .or. -
   atom @ligseg @resnum H275 .or. -
   atom @ligseg @resnum H276 .or. -
   atom @ligseg @resnum C277 .or. -
   atom @ligseg @resnum C278 .or. -
   atom @ligseg @resnum H279 .or. -
   atom @ligseg @resnum C280 .or. -
   atom @ligseg @resnum H281 .or. -
   atom @ligseg @resnum C282 .or. -
   atom @ligseg @resnum C283 .or. -
   atom @ligseg @resnum H284 .or. -
   atom @ligseg @resnum C285 .or. -
   atom @ligseg @resnum H286 .or. -
   atom @ligseg @resnum C287 .or. -
   atom @ligseg @resnum C288 .or. -
   atom @ligseg @resnum H289 .or. -
   atom @ligseg @resnum H290 .or. -
   atom @ligseg @resnum H291 .or. -
   atom @ligseg @resnum C292 .or. -
   atom @ligseg @resnum H293 .or. -
   atom @ligseg @resnum H294 .or. -
   atom @ligseg @resnum H295 .or. -
   atom @ligseg @resnum C296 .or. -
   atom @ligseg @resnum H297 .or. -
   atom @ligseg @resnum H298 .or. -
   atom @ligseg @resnum H299 .or. -
   none ) end

define site1_sub17 - 
   select ( - 
   atom @ligseg @resnum C300 .or. -
   atom @ligseg @resnum N301 .or. -
   atom @ligseg @resnum H302 .or. -
   atom @ligseg @resnum C303 .or. -
   atom @ligseg @resnum C304 .or. -
   atom @ligseg @resnum H305 .or. -
   atom @ligseg @resnum C306 .or. -
   atom @ligseg @resnum H307 .or. -
   atom @ligseg @resnum C308 .or. -
   atom @ligseg @resnum Cl0L .or. -
   atom @ligseg @resnum C309 .or. -
   atom @ligseg @resnum H310 .or. -
   atom @ligseg @resnum C311 .or. -
   atom @ligseg @resnum H312 .or. -
   atom @ligseg @resnum LP0M .or. -
   none ) end

define site1_sub18 - 
   select ( - 
   atom @ligseg @resnum C313 .or. -
   atom @ligseg @resnum N314 .or. -
   atom @ligseg @resnum H315 .or. -
   atom @ligseg @resnum C316 .or. -
   atom @ligseg @resnum H317 .or. -
   atom @ligseg @resnum C318 .or. -
   atom @ligseg @resnum H319 .or. -
   atom @ligseg @resnum C320 .or. -
   atom @ligseg @resnum C321 .or. -
   atom @ligseg @resnum H322 .or. -
   atom @ligseg @resnum C323 .or. -
   atom @ligseg @resnum H324 .or. -
   atom @ligseg @resnum C325 .or. -
   atom @ligseg @resnum H326 .or. -
   atom @ligseg @resnum C327 .or. -
   atom @ligseg @resnum H328 .or. -
   atom @ligseg @resnum C329 .or. -
   atom @ligseg @resnum H330 .or. -
   atom @ligseg @resnum C331 .or. -
   atom @ligseg @resnum H332 .or. -
   atom @ligseg @resnum H333 .or. -
   none ) end

define site1_sub19 - 
   select ( - 
   atom @ligseg @resnum C334 .or. -
   atom @ligseg @resnum N335 .or. -
   atom @ligseg @resnum H336 .or. -
   atom @ligseg @resnum C337 .or. -
   atom @ligseg @resnum H338 .or. -
   atom @ligseg @resnum H339 .or. -
   atom @ligseg @resnum C340 .or. -
   atom @ligseg @resnum H341 .or. -
   atom @ligseg @resnum H342 .or. -
   atom @ligseg @resnum C343 .or. -
   atom @ligseg @resnum C344 .or. -
   atom @ligseg @resnum H345 .or. -
   atom @ligseg @resnum C346 .or. -
   atom @ligseg @resnum H347 .or. -
   atom @ligseg @resnum C348 .or. -
   atom @ligseg @resnum C349 .or. -
   atom @ligseg @resnum H350 .or. -
   atom @ligseg @resnum C351 .or. -
   atom @ligseg @resnum H352 .or. -
   atom @ligseg @resnum O353 .or. -
   atom @ligseg @resnum H354 .or. -
   none ) end

define site2_sub1 - 
   select ( - 
   atom @ligseg @resnum C355 .or. -
   atom @ligseg @resnum C356 .or. -
   atom @ligseg @resnum H357 .or. -
   atom @ligseg @resnum C358 .or. -
   atom @ligseg @resnum H359 .or. -
   atom @ligseg @resnum C360 .or. -
   atom @ligseg @resnum H361 .or. -
   atom @ligseg @resnum C362 .or. -
   atom @ligseg @resnum H363 .or. -
   none ) end

define site2_sub2 - 
   select ( - 
   atom @ligseg @resnum C364 .or. -
   atom @ligseg @resnum H365 .or. -
   atom @ligseg @resnum C366 .or. -
   atom @ligseg @resnum C367 .or. -
   atom @ligseg @resnum O368 .or. -
   atom @ligseg @resnum C369 .or. -
   atom @ligseg @resnum H370 .or. -
   atom @ligseg @resnum H371 .or. -
   atom @ligseg @resnum H372 .or. -
   atom @ligseg @resnum C373 .or. -
   atom @ligseg @resnum O374 .or. -
   atom @ligseg @resnum C375 .or. -
   atom @ligseg @resnum H376 .or. -
   atom @ligseg @resnum H377 .or. -
   atom @ligseg @resnum H378 .or. -
   atom @ligseg @resnum C379 .or. -
   atom @ligseg @resnum O380 .or. -
   atom @ligseg @resnum C381 .or. -
   atom @ligseg @resnum H382 .or. -
   atom @ligseg @resnum H383 .or. -
   atom @ligseg @resnum H384 .or. -
   none ) end

define site2_sub3 - 
   select ( - 
   atom @ligseg @resnum C385 .or. -
   atom @ligseg @resnum C386 .or. -
   atom @ligseg @resnum H387 .or. -
   atom @ligseg @resnum C388 .or. -
   atom @ligseg @resnum C389 .or. -
   atom @ligseg @resnum N390 .or. -
   atom @ligseg @resnum H391 .or. -
   atom @ligseg @resnum H392 .or. -
   atom @ligseg @resnum C393 .or. -
   atom @ligseg @resnum H394 .or. -
   atom @ligseg @resnum O395 .or. -
   atom @ligseg @resnum C396 .or. -
   atom @ligseg @resnum H397 .or. -
   atom @ligseg @resnum H398 .or. -
   atom @ligseg @resnum H399 .or. -
   none ) end

define site2_sub4 - 
   select ( - 
   atom @ligseg @resnum C400 .or. -
   atom @ligseg @resnum C401 .or. -
   atom @ligseg @resnum H402 .or. -
   atom @ligseg @resnum C403 .or. -
   atom @ligseg @resnum C404 .or. -
   atom @ligseg @resnum O405 .or. -
   atom @ligseg @resnum C406 .or. -
   atom @ligseg @resnum H407 .or. -
   atom @ligseg @resnum H408 .or. -
   atom @ligseg @resnum H409 .or. -
   atom @ligseg @resnum C410 .or. -
   atom @ligseg @resnum H411 .or. -
   atom @ligseg @resnum O412 .or. -
   atom @ligseg @resnum C413 .or. -
   atom @ligseg @resnum H414 .or. -
   atom @ligseg @resnum H415 .or. -
   atom @ligseg @resnum H416 .or. -
   none ) end

define site2_sub5 - 
   select ( - 
   atom @ligseg @resnum C417 .or. -
   atom @ligseg @resnum H418 .or. -
   atom @ligseg @resnum C419 .or. -
   atom @ligseg @resnum H420 .or. -
   atom @ligseg @resnum C421 .or. -
   atom @ligseg @resnum C422 .or. -
   atom @ligseg @resnum H423 .or. -
   atom @ligseg @resnum C424 .or. -
   atom @ligseg @resnum O425 .or. -
   atom @ligseg @resnum H426 .or. -
   none ) end

define site2_sub6 - 
   select ( - 
   atom @ligseg @resnum C427 .or. -
   atom @ligseg @resnum H428 .or. -
   atom @ligseg @resnum C429 .or. -
   atom @ligseg @resnum H430 .or. -
   atom @ligseg @resnum C431 .or. -
   atom @ligseg @resnum C432 .or. -
   atom @ligseg @resnum H433 .or. -
   atom @ligseg @resnum C434 .or. -
   atom @ligseg @resnum Cl0N .or. -
   atom @ligseg @resnum LP0O .or. -
   none ) end

define site2_sub7 - 
   select ( - 
   atom @ligseg @resnum C435 .or. -
   atom @ligseg @resnum C436 .or. -
   atom @ligseg @resnum H437 .or. -
   atom @ligseg @resnum C438 .or. -
   atom @ligseg @resnum H439 .or. -
   atom @ligseg @resnum C440 .or. -
   atom @ligseg @resnum C441 .or. -
   atom @ligseg @resnum H442 .or. -
   atom @ligseg @resnum N443 .or. -
   atom @ligseg @resnum O444 .or. -
   atom @ligseg @resnum O445 .or. -
   none ) end

define site2_sub8 - 
   select ( - 
   atom @ligseg @resnum C446 .or. -
   atom @ligseg @resnum C447 .or. -
   atom @ligseg @resnum H448 .or. -
   atom @ligseg @resnum C449 .or. -
   atom @ligseg @resnum C450 .or. -
   atom @ligseg @resnum O451 .or. -
   atom @ligseg @resnum C452 .or. -
   atom @ligseg @resnum H453 .or. -
   atom @ligseg @resnum H454 .or. -
   atom @ligseg @resnum C455 .or. -
   atom @ligseg @resnum H456 .or. -
   atom @ligseg @resnum H457 .or. -
   atom @ligseg @resnum H458 .or. -
   atom @ligseg @resnum C459 .or. -
   atom @ligseg @resnum H460 .or. -
   atom @ligseg @resnum O461 .or. -
   atom @ligseg @resnum C462 .or. -
   atom @ligseg @resnum H463 .or. -
   atom @ligseg @resnum H464 .or. -
   atom @ligseg @resnum C465 .or. -
   atom @ligseg @resnum H466 .or. -
   atom @ligseg @resnum H467 .or. -
   atom @ligseg @resnum H468 .or. -
   none ) end

define site2_sub9 - 
   select ( - 
   atom @ligseg @resnum C469 .or. -
   atom @ligseg @resnum C470 .or. -
   atom @ligseg @resnum H471 .or. -
   atom @ligseg @resnum C472 .or. -
   atom @ligseg @resnum C473 .or. -
   atom @ligseg @resnum O474 .or. -
   atom @ligseg @resnum H475 .or. -
   atom @ligseg @resnum C476 .or. -
   atom @ligseg @resnum H477 .or. -
   atom @ligseg @resnum O478 .or. -
   atom @ligseg @resnum H479 .or. -
   none ) end

define site2_sub10 - 
   select ( - 
   atom @ligseg @resnum C480 .or. -
   atom @ligseg @resnum C481 .or. -
   atom @ligseg @resnum H482 .or. -
   atom @ligseg @resnum C483 .or. -
   atom @ligseg @resnum H484 .or. -
   atom @ligseg @resnum C485 .or. -
   atom @ligseg @resnum C486 .or. -
   atom @ligseg @resnum H487 .or. -
   atom @ligseg @resnum N488 .or. -
   atom @ligseg @resnum H489 .or. -
   atom @ligseg @resnum C490 .or. -
   atom @ligseg @resnum O491 .or. -
   atom @ligseg @resnum C492 .or. -
   atom @ligseg @resnum H493 .or. -
   atom @ligseg @resnum C494 .or. -
   atom @ligseg @resnum H495 .or. -
   atom @ligseg @resnum H496 .or. -
   none ) end

define site2_sub11 - 
   select ( - 
   atom @ligseg @resnum C497 .or. -
   atom @ligseg @resnum C498 .or. -
   atom @ligseg @resnum C499 .or. -
   atom @ligseg @resnum H500 .or. -
   atom @ligseg @resnum C501 .or. -
   atom @ligseg @resnum H502 .or. -
   atom @ligseg @resnum C503 .or. -
   atom @ligseg @resnum H504 .or. -
   atom @ligseg @resnum C505 .or. -
   atom @ligseg @resnum O506 .or. -
   atom @ligseg @resnum N507 .or. -
   atom @ligseg @resnum H508 .or. -
   atom @ligseg @resnum H509 .or. -
   none ) end

define site2_sub12 - 
   select ( - 
   atom @ligseg @resnum C510 .or. -
   atom @ligseg @resnum C511 .or. -
   atom @ligseg @resnum H512 .or. -
   atom @ligseg @resnum C513 .or. -
   atom @ligseg @resnum H514 .or. -
   atom @ligseg @resnum C515 .or. -
   atom @ligseg @resnum C516 .or. -
   atom @ligseg @resnum H517 .or. -
   atom @ligseg @resnum C518 .or. -
   atom @ligseg @resnum H519 .or. -
   atom @ligseg @resnum C520 .or. -
   atom @ligseg @resnum H521 .or. -
   atom @ligseg @resnum H522 .or. -
   atom @ligseg @resnum C523 .or. -
   atom @ligseg @resnum H524 .or. -
   atom @ligseg @resnum H525 .or. -
   none ) end

define site2_sub13 - 
   select ( - 
   atom @ligseg @resnum C526 .or. -
   atom @ligseg @resnum C527 .or. -
   atom @ligseg @resnum H528 .or. -
   atom @ligseg @resnum C529 .or. -
   atom @ligseg @resnum H530 .or. -
   atom @ligseg @resnum C531 .or. -
   atom @ligseg @resnum C532 .or. -
   atom @ligseg @resnum H533 .or. -
   atom @ligseg @resnum N534 .or. -
   atom @ligseg @resnum H535 .or. -
   atom @ligseg @resnum H536 .or. -
   none ) end

define site2_sub14 - 
   select ( - 
   atom @ligseg @resnum C537 .or. -
   atom @ligseg @resnum H538 .or. -
   atom @ligseg @resnum C539 .or. -
   atom @ligseg @resnum H540 .or. -
   atom @ligseg @resnum C541 .or. -
   atom @ligseg @resnum H542 .or. -
   atom @ligseg @resnum C543 .or. -
   atom @ligseg @resnum C544 .or. -
   atom @ligseg @resnum N545 .or. -
   atom @ligseg @resnum O546 .or. -
   atom @ligseg @resnum O547 .or. -
   none ) end

define site2_sub15 - 
   select ( - 
   atom @ligseg @resnum C548 .or. -
   atom @ligseg @resnum C549 .or. -
   atom @ligseg @resnum H550 .or. -
   atom @ligseg @resnum C551 .or. -
   atom @ligseg @resnum H552 .or. -
   atom @ligseg @resnum C553 .or. -
   atom @ligseg @resnum C554 .or. -
   atom @ligseg @resnum H555 .or. -
   atom @ligseg @resnum C556 .or. -
   atom @ligseg @resnum H557 .or. -
   atom @ligseg @resnum C558 .or. -
   atom @ligseg @resnum H559 .or. -
   atom @ligseg @resnum H560 .or. -
   atom @ligseg @resnum H561 .or. -
   atom @ligseg @resnum C562 .or. -
   atom @ligseg @resnum H563 .or. -
   atom @ligseg @resnum H564 .or. -
   atom @ligseg @resnum H565 .or. -
   none ) end

define site2_sub16 - 
   select ( - 
   atom @ligseg @resnum C566 .or. -
   atom @ligseg @resnum C567 .or. -
   atom @ligseg @resnum H568 .or. -
   atom @ligseg @resnum C569 .or. -
   atom @ligseg @resnum C570 .or. -
   atom @ligseg @resnum N571 .or. -
   atom @ligseg @resnum H572 .or. -
   atom @ligseg @resnum H573 .or. -
   atom @ligseg @resnum C574 .or. -
   atom @ligseg @resnum H575 .or. -
   atom @ligseg @resnum N576 .or. -
   atom @ligseg @resnum H577 .or. -
   atom @ligseg @resnum C578 .or. -
   atom @ligseg @resnum H579 .or. -
   atom @ligseg @resnum H580 .or. -
   atom @ligseg @resnum H581 .or. -
   none ) end

define site2_sub17 - 
   select ( - 
   atom @ligseg @resnum C582 .or. -
   atom @ligseg @resnum H583 .or. -
   atom @ligseg @resnum C584 .or. -
   atom @ligseg @resnum H585 .or. -
   atom @ligseg @resnum C586 .or. -
   atom @ligseg @resnum C587 .or. -
   atom @ligseg @resnum H588 .or. -
   atom @ligseg @resnum C589 .or. -
   atom @ligseg @resnum N590 .or. -
   atom @ligseg @resnum C591 .or. -
   atom @ligseg @resnum H592 .or. -
   atom @ligseg @resnum H593 .or. -
   atom @ligseg @resnum H594 .or. -
   atom @ligseg @resnum C595 .or. -
   atom @ligseg @resnum H596 .or. -
   atom @ligseg @resnum H597 .or. -
   atom @ligseg @resnum H598 .or. -
   none ) end

define site2_sub18 - 
   select ( - 
   atom @ligseg @resnum C599 .or. -
   atom @ligseg @resnum C600 .or. -
   atom @ligseg @resnum H601 .or. -
   atom @ligseg @resnum C602 .or. -
   atom @ligseg @resnum C603 .or. -
   atom @ligseg @resnum C604 .or. -
   atom @ligseg @resnum H605 .or. -
   atom @ligseg @resnum N606 .or. -
   atom @ligseg @resnum N607 .or. -
   atom @ligseg @resnum H608 .or. -
   atom @ligseg @resnum C609 .or. -
   atom @ligseg @resnum H610 .or. -
   none ) end

define site2_sub19 - 
   select ( - 
   atom @ligseg @resnum C611 .or. -
   atom @ligseg @resnum C612 .or. -
   atom @ligseg @resnum N613 .or. -
   atom @ligseg @resnum C614 .or. -
   atom @ligseg @resnum H615 .or. -
   atom @ligseg @resnum N616 .or. -
   atom @ligseg @resnum H617 .or. -
   atom @ligseg @resnum C618 .or. -
   atom @ligseg @resnum C619 .or. -
   atom @ligseg @resnum H620 .or. -
   atom @ligseg @resnum C621 .or. -
   atom @ligseg @resnum H622 .or. -
   none ) end

define site2_sub20 - 
   select ( - 
   atom @ligseg @resnum C623 .or. -
   atom @ligseg @resnum H624 .or. -
   atom @ligseg @resnum C625 .or. -
   atom @ligseg @resnum H626 .or. -
   atom @ligseg @resnum C627 .or. -
   atom @ligseg @resnum C628 .or. -
   atom @ligseg @resnum H629 .or. -
   atom @ligseg @resnum C630 .or. -
   atom @ligseg @resnum N631 .or. -
   atom @ligseg @resnum O632 .or. -
   atom @ligseg @resnum O633 .or. -
   none ) end

define site2_sub21 - 
   select ( - 
   atom @ligseg @resnum C634 .or. -
   atom @ligseg @resnum C635 .or. -
   atom @ligseg @resnum H636 .or. -
   atom @ligseg @resnum C637 .or. -
   atom @ligseg @resnum C638 .or. -
   atom @ligseg @resnum O639 .or. -
   atom @ligseg @resnum C640 .or. -
   atom @ligseg @resnum O641 .or. -
   atom @ligseg @resnum C642 .or. -
   atom @ligseg @resnum H643 .or. -
   atom @ligseg @resnum H644 .or. -
   atom @ligseg @resnum H645 .or. -
   atom @ligseg @resnum C646 .or. -
   atom @ligseg @resnum H647 .or. -
   atom @ligseg @resnum O648 .or. -
   atom @ligseg @resnum C649 .or. -
   atom @ligseg @resnum H650 .or. -
   atom @ligseg @resnum H651 .or. -
   atom @ligseg @resnum H652 .or. -
   none ) end

define site2_sub22 - 
   select ( - 
   atom @ligseg @resnum C653 .or. -
   atom @ligseg @resnum C654 .or. -
   atom @ligseg @resnum H655 .or. -
   atom @ligseg @resnum C656 .or. -
   atom @ligseg @resnum H657 .or. -
   atom @ligseg @resnum C658 .or. -
   atom @ligseg @resnum C659 .or. -
   atom @ligseg @resnum H660 .or. -
   atom @ligseg @resnum Br0P .or. -
   atom @ligseg @resnum LP0Q .or. -
   none ) end

define site2_sub23 - 
   select ( - 
   atom @ligseg @resnum C661 .or. -
   atom @ligseg @resnum C662 .or. -
   atom @ligseg @resnum H663 .or. -
   atom @ligseg @resnum C664 .or. -
   atom @ligseg @resnum C665 .or. -
   atom @ligseg @resnum C666 .or. -
   atom @ligseg @resnum H667 .or. -
   atom @ligseg @resnum C668 .or. -
   atom @ligseg @resnum H669 .or. -
   atom @ligseg @resnum N670 .or. -
   atom @ligseg @resnum N671 .or. -
   atom @ligseg @resnum H672 .or. -
   none ) end

define site2_sub24 - 
   select ( - 
   atom @ligseg @resnum C673 .or. -
   atom @ligseg @resnum C674 .or. -
   atom @ligseg @resnum H675 .or. -
   atom @ligseg @resnum C676 .or. -
   atom @ligseg @resnum H677 .or. -
   atom @ligseg @resnum C678 .or. -
   atom @ligseg @resnum C679 .or. -
   atom @ligseg @resnum H680 .or. -
   atom @ligseg @resnum N681 .or. -
   atom @ligseg @resnum C682 .or. -
   atom @ligseg @resnum H683 .or. -
   atom @ligseg @resnum H684 .or. -
   atom @ligseg @resnum H685 .or. -
   atom @ligseg @resnum C686 .or. -
   atom @ligseg @resnum H687 .or. -
   atom @ligseg @resnum H688 .or. -
   atom @ligseg @resnum H689 .or. -
   none ) end

auto angle dihe  !! do not call after deleting sub-sub terms or loading in water
bomblev -1

! delete angles and dihedrals between alchem groups
set ii = 1
label deletesiteloop
if @ii .le. @nsites then

   set jj = 1
   label delete1loop
   if @jj .le. @nsubs@@ii then

      calc kk = @jj + 1
      label delete2loop
      if @kk .le. @nsubs@@ii then

         dele connectivity sele ( site@{ii}_sub@@jj ) show end sele ( site@{ii}_sub@@kk ) show end
         calc kk = @kk + 1
         goto delete2loop
      endif

      calc jj = @jj + 1
      goto delete1loop
   endif

   calc ii = @ii + 1
   goto deletesiteloop
endif

!! ! System specific deletion (linear groups)
!! dele dihe sele (atom LIG 1 ATOMNAME) show end

!! Load solvent
read sequ pdb name @builddir/solvent.pdb
generate WT00 first none last none setup noangl nodihe
read coor pdb resid name @builddir/solvent.pdb

!! !! Load ions
!! read sequ pdb name @builddir/ions.pdb
!! generate HETA first none last none setup noangl nodihe
!! read coor pdb resid name @builddir/ions.pdb

print coor sele .not. init end

bomblev 0

!! !! Write Initial System to Disk
!! write psf card name patch.psf
!! * patch psf file
!! *
!! write coor pdb card name patch.pdb
!! * patch pdb file
!! *
!! write coor card name patch.crd
!! * patch crd file
!! *

!! Create water box & periodic images
coor stat
crystal define cubic @box @box @box 90. 90. 90.
crystal build cutoff 14 nope 0
image byres xcen 0 ycen 0 zcen 0 sele resn tip3 .or. resn sod .or. resn cla end
image byseg xcen 0 ycen 0 zcen 0 sele .not. ( resn tip3 .or. resn sod .or. resn cla ) end

!! Copy main coords into comp set
cons harm clear
coor copy comp

! LDBI math: for every "pair" there are 5 ldbi's
set ii = 1
set ldbibias = 0
label ldbimathloop
if @ii .le. @nsites then
   calc ldbibias = @ldbibias + ( ( @nsubs@@ii * (@nsubs@@ii - 1) / 2 ) * 5 )
   INCR ii by 1
   goto ldbimathloop
endif
set charge = ?cgtot

calc blockplusone = @nblocks + 1

!! BLOCK setup
BLOCK @blockplusone
   clear
END
BLOCK @blockplusone !RX! NREP @nreps
   Call 2 sele site1_sub1 show end
   Call 3 sele site1_sub2 show end
   Call 4 sele site1_sub3 show end
   Call 5 sele site1_sub4 show end
   Call 6 sele site1_sub5 show end
   Call 7 sele site1_sub6 show end
   Call 8 sele site1_sub7 show end
   Call 9 sele site1_sub8 show end
   Call 10 sele site1_sub9 show end
   Call 11 sele site1_sub10 show end
   Call 12 sele site1_sub11 show end
   Call 13 sele site1_sub12 show end
   Call 14 sele site1_sub13 show end
   Call 15 sele site1_sub14 show end
   Call 16 sele site1_sub15 show end
   Call 17 sele site1_sub16 show end
   Call 18 sele site1_sub17 show end
   Call 19 sele site1_sub18 show end
   Call 20 sele site1_sub19 show end
   Call 21 sele site2_sub1 show end
   Call 22 sele site2_sub2 show end
   Call 23 sele site2_sub3 show end
   Call 24 sele site2_sub4 show end
   Call 25 sele site2_sub5 show end
   Call 26 sele site2_sub6 show end
   Call 27 sele site2_sub7 show end
   Call 28 sele site2_sub8 show end
   Call 29 sele site2_sub9 show end
   Call 30 sele site2_sub10 show end
   Call 31 sele site2_sub11 show end
   Call 32 sele site2_sub12 show end
   Call 33 sele site2_sub13 show end
   Call 34 sele site2_sub14 show end
   Call 35 sele site2_sub15 show end
   Call 36 sele site2_sub16 show end
   Call 37 sele site2_sub17 show end
   Call 38 sele site2_sub18 show end
   Call 39 sele site2_sub19 show end
   Call 40 sele site2_sub20 show end
   Call 41 sele site2_sub21 show end
   Call 42 sele site2_sub22 show end
   Call 43 sele site2_sub23 show end
   Call 44 sele site2_sub24 show end

   qldm theta
   lang temp @temp
   !RX! phmd ph 7
   soft on   ! this turns on soft-cores
   pmel ex   ! this turns on PME

   ldin 1 1.0  0.0  5.0  0.0  5.0
   ldin 2  0.0526 0.0  5.0  @lams1s1 5.0 !RX! NONE
   ldin 3  0.0526 0.0  5.0  @lams1s2 5.0 !RX! UNEG 7.0
   ldin 4  0.0526 0.0  5.0  @lams1s3 5.0 !RX! UPOS 7.0
   ldin 5  0.0526 0.0  5.0  @lams1s4 5.0 !RX! UNEG 7.0
   ldin 6  0.0526 0.0  5.0  @lams1s5 5.0 !RX! UPOS 7.0
   ldin 7  0.0526 0.0  5.0  @lams1s6 5.0 !RX! UNEG 7.0
   ldin 8  0.0526 0.0  5.0  @lams1s7 5.0 !RX! UPOS 7.0
   ldin 9  0.0526 0.0  5.0  @lams1s8 5.0 !RX! UNEG 7.0
   ldin 10 0.0526 0.0  5.0  @lams1s9 5.0 !RX! UPOS 7.0
   ldin 11 0.0526 0.0  5.0  @lams1s10 5.0 !RX! UNEG 7.0
   ldin 12 0.0526 0.0  5.0  @lams1s11 5.0 !RX! UPOS 7.0
   ldin 13 0.0526 0.0  5.0  @lams1s12 5.0 !RX! UNEG 7.0
   ldin 14 0.0526 0.0  5.0  @lams1s13 5.0 !RX! UPOS 7.0
   ldin 15 0.0526 0.0  5.0  @lams1s14 5.0 !RX! UNEG 7.0
   ldin 16 0.0526 0.0  5.0  @lams1s15 5.0 !RX! UPOS 7.0
   ldin 17 0.0526 0.0  5.0  @lams1s16 5.0 !RX! UNEG 7.0
   ldin 18 0.0526 0.0  5.0  @lams1s17 5.0 !RX! UPOS 7.0
   ldin 19 0.0526 0.0  5.0  @lams1s18 5.0 !RX! UNEG 7.0
   ldin 20 0.0526 0.0  5.0  @lams1s19 5.0 !RX! UPOS 7.0
   ldin 21 0.0417 0.0  5.0  @lams2s1 5.0 !RX! NONE
   ldin 22 0.0417 0.0  5.0  @lams2s2 5.0 !RX! UNEG 7.0
   ldin 23 0.0417 0.0  5.0  @lams2s3 5.0 !RX! UPOS 7.0
   ldin 24 0.0417 0.0  5.0  @lams2s4 5.0 !RX! UNEG 7.0
   ldin 25 0.0417 0.0  5.0  @lams2s5 5.0 !RX! UPOS 7.0
   ldin 26 0.0417 0.0  5.0  @lams2s6 5.0 !RX! UNEG 7.0
   ldin 27 0.0417 0.0  5.0  @lams2s7 5.0 !RX! UPOS 7.0
   ldin 28 0.0417 0.0  5.0  @lams2s8 5.0 !RX! UNEG 7.0
   ldin 29 0.0417 0.0  5.0  @lams2s9 5.0 !RX! UPOS 7.0
   ldin 30 0.0417 0.0  5.0  @lams2s10 5.0 !RX! UNEG 7.0
   ldin 31 0.0417 0.0  5.0  @lams2s11 5.0 !RX! UPOS 7.0
   ldin 32 0.0417 0.0  5.0  @lams2s12 5.0 !RX! UNEG 7.0
   ldin 33 0.0417 0.0  5.0  @lams2s13 5.0 !RX! UPOS 7.0
   ldin 34 0.0417 0.0  5.0  @lams2s14 5.0 !RX! UNEG 7.0
   ldin 35 0.0417 0.0  5.0  @lams2s15 5.0 !RX! UPOS 7.0
   ldin 36 0.0417 0.0  5.0  @lams2s16 5.0 !RX! UNEG 7.0
   ldin 37 0.0417 0.0  5.0  @lams2s17 5.0 !RX! UPOS 7.0
   ldin 38 0.0417 0.0  5.0  @lams2s18 5.0 !RX! UNEG 7.0
   ldin 39 0.0417 0.0  5.0  @lams2s19 5.0 !RX! UPOS 7.0
   ldin 40 0.0417 0.0  5.0  @lams2s20 5.0 !RX! UNEG 7.0
   ldin 41 0.0417 0.0  5.0  @lams2s21 5.0 !RX! UPOS 7.0
   ldin 42 0.0417 0.0  5.0  @lams2s22 5.0 !RX! UNEG 7.0
   ldin 43 0.0417 0.0  5.0  @lams2s23 5.0 !RX! UPOS 7.0
   ldin 44 0.0417 0.0  5.0  @lams2s24 5.0 !RX! UNEG 7.0

   set excl1 = 2 3 2 4 2 5 2 6 2 7 2 8 2 9 2 10 2 11 2 12 2 13
   set excl2 = 2 14 2 15 2 16 2 17 2 18 2 19 2 20 3 4 3 5 3 6 3 7
   set excl3 = 3 8 3 9 3 10 3 11 3 12 3 13 3 14 3 15 3 16 3 17 3 18
   set excl4 = 3 19 3 20 4 5 4 6 4 7 4 8 4 9 4 10 4 11 4 12 4 13
   set excl5 = 4 14 4 15 4 16 4 17 4 18 4 19 4 20 5 6 5 7 5 8 5 9
   set excl6 = 5 10 5 11 5 12 5 13 5 14 5 15 5 16 5 17 5 18 5 19 5 20
   set excl7 = 6 7 6 8 6 9 6 10 6 11 6 12 6 13 6 14 6 15 6 16 6 17
   set excl8 = 6 18 6 19 6 20 7 8 7 9 7 10 7 11 7 12 7 13 7 14 7 15
   set excl9 = 7 16 7 17 7 18 7 19 7 20 8 9 8 10 8 11 8 12 8 13 8 14
   set excl10 = 8 15 8 16 8 17 8 18 8 19 8 20 9 10 9 11 9 12 9 13 9 14
   set excl11 = 9 15 9 16 9 17 9 18 9 19 9 20 10 11 10 12 10 13 10 14 10 15
   set excl12 = 10 16 10 17 10 18 10 19 10 20 11 12 11 13 11 14 11 15 11 16 11 17
   set excl13 = 11 18 11 19 11 20 12 13 12 14 12 15 12 16 12 17 12 18 12 19 12 20
   set excl14 = 13 14 13 15 13 16 13 17 13 18 13 19 13 20 14 15 14 16 14 17 14 18
   set excl15 = 14 19 14 20 15 16 15 17 15 18 15 19 15 20 16 17 16 18 16 19 16 20
   set excl16 = 17 18 17 19 17 20 18 19 18 20 19 20 21 22 21 23 21 24 21 25 21 26
   set excl17 = 21 27 21 28 21 29 21 30 21 31 21 32 21 33 21 34 21 35 21 36 21 37
   set excl18 = 21 38 21 39 21 40 21 41 21 42 21 43 21 44 22 23 22 24 22 25 22 26
   set excl19 = 22 27 22 28 22 29 22 30 22 31 22 32 22 33 22 34 22 35 22 36 22 37
   set excl20 = 22 38 22 39 22 40 22 41 22 42 22 43 22 44 23 24 23 25 23 26 23 27
   set excl21 = 23 28 23 29 23 30 23 31 23 32 23 33 23 34 23 35 23 36 23 37 23 38
   set excl22 = 23 39 23 40 23 41 23 42 23 43 23 44 24 25 24 26 24 27 24 28 24 29
   set excl23 = 24 30 24 31 24 32 24 33 24 34 24 35 24 36 24 37 24 38 24 39 24 40
   set excl24 = 24 41 24 42 24 43 24 44 25 26 25 27 25 28 25 29 25 30 25 31 25 32
   set excl25 = 25 33 25 34 25 35 25 36 25 37 25 38 25 39 25 40 25 41 25 42 25 43
   set excl26 = 25 44 26 27 26 28 26 29 26 30 26 31 26 32 26 33 26 34 26 35 26 36
   set excl27 = 26 37 26 38 26 39 26 40 26 41 26 42 26 43 26 44 27 28 27 29 27 30
   set excl28 = 27 31 27 32 27 33 27 34 27 35 27 36 27 37 27 38 27 39 27 40 27 41
   set excl29 = 27 42 27 43 27 44 28 29 28 30 28 31 28 32 28 33 28 34 28 35 28 36
   set excl30 = 28 37 28 38 28 39 28 40 28 41 28 42 28 43 28 44 29 30 29 31 29 32
   set excl31 = 29 33 29 34 29 35 29 36 29 37 29 38 29 39 29 40 29 41 29 42 29 43
   set excl32 = 29 44 30 31 30 32 30 33 30 34 30 35 30 36 30 37 30 38 30 39 30 40
   set excl33 = 30 41 30 42 30 43 30 44 31 32 31 33 31 34 31 35 31 36 31 37 31 38
   set excl34 = 31 39 31 40 31 41 31 42 31 43 31 44 32 33 32 34 32 35 32 36 32 37
   set excl35 = 32 38 32 39 32 40 32 41 32 42 32 43 32 44 33 34 33 35 33 36 33 37
   set excl36 = 33 38 33 39 33 40 33 41 33 42 33 43 33 44 34 35 34 36 34 37 34 38
   set excl37 = 34 39 34 40 34 41 34 42 34 43 34 44 35 36 35 37 35 38 35 39 35 40
   set excl38 = 35 41 35 42 35 43 35 44 36 37 36 38 36 39 36 40 36 41 36 42 36 43
   set excl39 = 36 44 37 38 37 39 37 40 37 41 37 42 37 43 37 44 38 39 38 40 38 41
   set excl40 = 38 42 38 43 38 44 39 40 39 41 39 42 39 43 39 44 40 41 40 42 40 43
   set excl41 = 40 44 41 42 41 43 41 44 42 43 42 44 43 44
   excl @excl1 @excl2 @excl3 @excl4 @excl5 @excl6 @excl7 @excl8 @excl9 @excl10 @excl11 @excl12 @excl13 @excl14 @excl15 @excl16 @excl17 @excl18 @excl19 @excl20 @excl21 @excl22 @excl23 @excl24 @excl25 @excl26 @excl27 @excl28 @excl29 @excl30 @excl31 @excl32 @excl33 @excl34 @excl35 @excl36 @excl37 @excl38 @excl39 @excl40 @excl41

   !!rmla bond thet dihe impr 
   rmla bond thet impr 
   msld 0  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  fnex @fnex
   msma

   ! Check block.doc for functional form of these biasing potentials
   calc nbiaspot = 5 * ( @nblocks * ( @nblocks - 1 ) ) / 2
   ldbi @nbiaspot
   set ibias = 1
   set iblock = 0
   set si = 1
   label loop5_vb
   if @si .le. @nsites then
      set jblock = @iblock
      set sj = @si
      label loop5b_vb
      if @sj .le. @nsites then
         set ii = 1
         label loop6_vb
         if @ii .le. @nsubs@@{si} then
            calc ip1 = @ii + 1 + @iblock
            set jj = 1
            if @si .eq. @sj then
               calc jj = @ii + 1
            endif
            label loop7_vb
            if @jj .le. @nsubs@@{sj} then
               calc jp1 = @jj + 1 + @jblock
   
               set c_shift = 0.0
               set x_shift = 0.0
               set s_shift = 0.0
               !vbrex! if @si .eq. @sj then
               !vbrex!    calc c_shift = 1.2 * (@myrep - @ncentral)
               !vbrex!    calc s_shift = 0.3 * (@myrep - @ncentral)
               !vbrex! endif
   
               calc coeff = @cs@@{si}s@@{ii}s@@{sj}s@@{jj} + @{c_shift}
               ldbv @ibias @ip1 @jp1 6 0.0 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @xs@@{si}s@@{ii}s@@{sj}s@@{jj} + @{x_shift}
               ldbv @ibias @ip1 @jp1 10 -5.56 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @ss@@{si}s@@{ii}s@@{sj}s@@{jj} + @{s_shift}
               ldbv @ibias @ip1 @jp1 8 0.017 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @xs@@{sj}s@@{jj}s@@{si}s@@{ii} + @{x_shift}
               ldbv @ibias @jp1 @ip1 10 -5.56 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @ss@@{sj}s@@{jj}s@@{si}s@@{ii} + @{s_shift}
               ldbv @ibias @jp1 @ip1 8 0.017 @coeff 0
               calc ibias = @ibias + 1
               calc jj = @jj + 1
               goto loop7_vb
            endif
            calc ii = @ii + 1
            goto loop6_vb
         endif
         calc jblock = @jblock + @nsubs@@{sj}
         calc sj = @sj + 1
         goto loop5b_vb
      endif
      calc iblock = @iblock + @nsubs@@{si}
      calc si = @si + 1
      goto loop5_vb
   endif
END

!! !! Set NOE distance restraints
!! NOE
!!    RESET
!! END
!! 
!! faster on
!! !! set up energy parameters if you want to use NOEs
!! nbonds atom fswitch vdw vfswitch cdie eps 1 -
!!     cutnb 14.0 cutim 14.0 ctonnb 10.0 ctofnb 12.0

!! energy
!! NOE
!! ! Site 1
!!    assign sele atom LIG 1 Atom1 end sele atom LIG 1 Atom2 end -
!!    kmin 1.0 rmin 0.0 kmax 1.0 rmax 0.2 fmax 2.0 rswitch 2.0 sexp 1.0
!! ! Site 2
!!    assign sele atom LIG 1 Atom1 end sele atom LIG 1 Atom2 end -
!!    kmin 1.0 rmin 0.0 kmax 1.0 rmax 0.2 fmax 2.0 rswitch 2.0 sexp 1.0
!! 
!!    print anal
!! END


