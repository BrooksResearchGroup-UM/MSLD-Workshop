* CHARMM input file for Multi-Site lambda-dynamics
* generated by msld_py_prep (JV,LC) for ALF (RLH)
*
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  Multi-Site Lambda Dynamics 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

set fnex = 5.5 
!!set sysname = name
set builddir = prep
set box = ????
set temp = 298.15
set ligseg = lig
set resnum = 1

! perturbation variables
set nsites = 2 
set nsubs1 = 32 
set nsubs2 = 1 
set nblocks = 33 

bomblev -2

!! Read in toppar stream file
stream @builddir/toppar.str

read rtf append card name @builddir/core.rtf
read param flex append card name @builddir/full_ligand.prm

!! !! Reads coordinates and pdb file for the protein
!! read sequ pdb name @builddir/protein.pdb
!! generate SEGID first NTER last CTER setup warn
!! read coor pdb resid name @builddir/protein.pdb
!! 
!! ic generate
!! ic param
!! ic build 
!! hbuild sele hydrogen end
!! auto angle dihe

!! Reads coordinates and pdb file for the ligand
read sequ pdb name @builddir/core.pdb
generate @ligseg setup
read coor pdb resid name @builddir/core.pdb

!! Read in the ligand patch rtf files
read rtf append card name @builddir/site1_sub1_pres.rtf
read rtf append card name @builddir/site1_sub2_pres.rtf
read rtf append card name @builddir/site1_sub3_pres.rtf
read rtf append card name @builddir/site1_sub4_pres.rtf
read rtf append card name @builddir/site1_sub5_pres.rtf
read rtf append card name @builddir/site1_sub6_pres.rtf
read rtf append card name @builddir/site1_sub7_pres.rtf
read rtf append card name @builddir/site1_sub8_pres.rtf
read rtf append card name @builddir/site1_sub9_pres.rtf
read rtf append card name @builddir/site1_sub10_pres.rtf
read rtf append card name @builddir/site1_sub11_pres.rtf
read rtf append card name @builddir/site1_sub12_pres.rtf
read rtf append card name @builddir/site1_sub13_pres.rtf
read rtf append card name @builddir/site1_sub14_pres.rtf
read rtf append card name @builddir/site1_sub15_pres.rtf
read rtf append card name @builddir/site1_sub16_pres.rtf
read rtf append card name @builddir/site1_sub17_pres.rtf
read rtf append card name @builddir/site1_sub18_pres.rtf
read rtf append card name @builddir/site1_sub19_pres.rtf
read rtf append card name @builddir/site1_sub20_pres.rtf
read rtf append card name @builddir/site1_sub21_pres.rtf
read rtf append card name @builddir/site1_sub22_pres.rtf
read rtf append card name @builddir/site1_sub23_pres.rtf
read rtf append card name @builddir/site1_sub24_pres.rtf
read rtf append card name @builddir/site1_sub25_pres.rtf
read rtf append card name @builddir/site1_sub26_pres.rtf
read rtf append card name @builddir/site1_sub27_pres.rtf
read rtf append card name @builddir/site1_sub28_pres.rtf
read rtf append card name @builddir/site1_sub29_pres.rtf
read rtf append card name @builddir/site1_sub30_pres.rtf
read rtf append card name @builddir/site1_sub31_pres.rtf
read rtf append card name @builddir/site1_sub32_pres.rtf
read rtf append card name @builddir/site2_sub1_pres.rtf

!! Read in the ligand fragment pdb files
ic generate

patch p1_1 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub1_frag.pdb
ic param
ic build

patch p1_2 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub2_frag.pdb
ic param
ic build

patch p1_3 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub3_frag.pdb
ic param
ic build

patch p1_4 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub4_frag.pdb
ic param
ic build

patch p1_5 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub5_frag.pdb
ic param
ic build

patch p1_6 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub6_frag.pdb
ic param
ic build

patch p1_7 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub7_frag.pdb
ic param
ic build

patch p1_8 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub8_frag.pdb
ic param
ic build

patch p1_9 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub9_frag.pdb
ic param
ic build

patch p1_10 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub10_frag.pdb
ic param
ic build

patch p1_11 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub11_frag.pdb
ic param
ic build

patch p1_12 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub12_frag.pdb
ic param
ic build

patch p1_13 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub13_frag.pdb
ic param
ic build

patch p1_14 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub14_frag.pdb
ic param
ic build

patch p1_15 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub15_frag.pdb
ic param
ic build

patch p1_16 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub16_frag.pdb
ic param
ic build

patch p1_17 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub17_frag.pdb
ic param
ic build

patch p1_18 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub18_frag.pdb
ic param
ic build

patch p1_19 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub19_frag.pdb
ic param
ic build

patch p1_20 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub20_frag.pdb
ic param
ic build

patch p1_21 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub21_frag.pdb
ic param
ic build

patch p1_22 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub22_frag.pdb
ic param
ic build

patch p1_23 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub23_frag.pdb
ic param
ic build

patch p1_24 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub24_frag.pdb
ic param
ic build

patch p1_25 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub25_frag.pdb
ic param
ic build

patch p1_26 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub26_frag.pdb
ic param
ic build

patch p1_27 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub27_frag.pdb
ic param
ic build

patch p1_28 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub28_frag.pdb
ic param
ic build

patch p1_29 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub29_frag.pdb
ic param
ic build

patch p1_30 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub30_frag.pdb
ic param
ic build

patch p1_31 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub31_frag.pdb
ic param
ic build

patch p1_32 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub32_frag.pdb
ic param
ic build

patch p2_1 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub1_frag.pdb
ic param
ic build

!! Read in LonePair sites (if applicable)
stream @builddir/lpsites.inp

!! Define MSLD substituent selections
define site1_sub1 - 
   select ( - 
   atom @ligseg @resnum C022 .or. -
   atom @ligseg @resnum H023 .or. -
   atom @ligseg @resnum C024 .or. -
   atom @ligseg @resnum H025 .or. -
   atom @ligseg @resnum C026 .or. -
   atom @ligseg @resnum H027 .or. -
   atom @ligseg @resnum C028 .or. -
   atom @ligseg @resnum H029 .or. -
   atom @ligseg @resnum C030 .or. -
   atom @ligseg @resnum H031 .or. -
   none ) end

define site1_sub2 - 
   select ( - 
   atom @ligseg @resnum C032 .or. -
   atom @ligseg @resnum H033 .or. -
   atom @ligseg @resnum C034 .or. -
   atom @ligseg @resnum H035 .or. -
   atom @ligseg @resnum C036 .or. -
   atom @ligseg @resnum C037 .or. -
   atom @ligseg @resnum F038 .or. -
   atom @ligseg @resnum F039 .or. -
   atom @ligseg @resnum F040 .or. -
   atom @ligseg @resnum C041 .or. -
   atom @ligseg @resnum Cl0A .or. -
   atom @ligseg @resnum C042 .or. -
   atom @ligseg @resnum H043 .or. -
   atom @ligseg @resnum LP0B .or. -
   none ) end

define site1_sub3 - 
   select ( - 
   atom @ligseg @resnum C044 .or. -
   atom @ligseg @resnum H045 .or. -
   atom @ligseg @resnum C046 .or. -
   atom @ligseg @resnum H047 .or. -
   atom @ligseg @resnum C048 .or. -
   atom @ligseg @resnum C049 .or. -
   atom @ligseg @resnum H050 .or. -
   atom @ligseg @resnum C051 .or. -
   atom @ligseg @resnum H052 .or. -
   atom @ligseg @resnum C053 .or. -
   atom @ligseg @resnum H054 .or. -
   atom @ligseg @resnum H055 .or. -
   atom @ligseg @resnum H056 .or. -
   none ) end

define site1_sub4 - 
   select ( - 
   atom @ligseg @resnum C057 .or. -
   atom @ligseg @resnum H058 .or. -
   atom @ligseg @resnum C059 .or. -
   atom @ligseg @resnum H060 .or. -
   atom @ligseg @resnum C061 .or. -
   atom @ligseg @resnum C062 .or. -
   atom @ligseg @resnum H063 .or. -
   atom @ligseg @resnum C064 .or. -
   atom @ligseg @resnum H065 .or. -
   atom @ligseg @resnum C066 .or. -
   atom @ligseg @resnum H067 .or. -
   atom @ligseg @resnum H068 .or. -
   atom @ligseg @resnum C069 .or. -
   atom @ligseg @resnum H070 .or. -
   atom @ligseg @resnum H071 .or. -
   atom @ligseg @resnum H072 .or. -
   none ) end

define site1_sub5 - 
   select ( - 
   atom @ligseg @resnum C073 .or. -
   atom @ligseg @resnum H074 .or. -
   atom @ligseg @resnum C075 .or. -
   atom @ligseg @resnum H076 .or. -
   atom @ligseg @resnum C077 .or. -
   atom @ligseg @resnum C078 .or. -
   atom @ligseg @resnum H079 .or. -
   atom @ligseg @resnum C080 .or. -
   atom @ligseg @resnum H081 .or. -
   atom @ligseg @resnum C082 .or. -
   atom @ligseg @resnum H083 .or. -
   atom @ligseg @resnum C084 .or. -
   atom @ligseg @resnum H085 .or. -
   atom @ligseg @resnum H086 .or. -
   atom @ligseg @resnum H087 .or. -
   atom @ligseg @resnum C088 .or. -
   atom @ligseg @resnum H089 .or. -
   atom @ligseg @resnum H090 .or. -
   atom @ligseg @resnum H091 .or. -
   none ) end

define site1_sub6 - 
   select ( - 
   atom @ligseg @resnum C092 .or. -
   atom @ligseg @resnum H093 .or. -
   atom @ligseg @resnum C094 .or. -
   atom @ligseg @resnum H095 .or. -
   atom @ligseg @resnum C096 .or. -
   atom @ligseg @resnum C097 .or. -
   atom @ligseg @resnum H098 .or. -
   atom @ligseg @resnum C099 .or. -
   atom @ligseg @resnum H100 .or. -
   atom @ligseg @resnum C101 .or. -
   atom @ligseg @resnum C102 .or. -
   atom @ligseg @resnum H103 .or. -
   atom @ligseg @resnum H104 .or. -
   atom @ligseg @resnum H105 .or. -
   atom @ligseg @resnum C106 .or. -
   atom @ligseg @resnum H107 .or. -
   atom @ligseg @resnum H108 .or. -
   atom @ligseg @resnum H109 .or. -
   atom @ligseg @resnum C110 .or. -
   atom @ligseg @resnum H111 .or. -
   atom @ligseg @resnum H112 .or. -
   atom @ligseg @resnum H113 .or. -
   none ) end

define site1_sub7 - 
   select ( - 
   atom @ligseg @resnum C114 .or. -
   atom @ligseg @resnum H115 .or. -
   atom @ligseg @resnum C116 .or. -
   atom @ligseg @resnum H117 .or. -
   atom @ligseg @resnum C118 .or. -
   atom @ligseg @resnum C119 .or. -
   atom @ligseg @resnum H120 .or. -
   atom @ligseg @resnum C121 .or. -
   atom @ligseg @resnum H122 .or. -
   atom @ligseg @resnum C123 .or. -
   atom @ligseg @resnum F124 .or. -
   atom @ligseg @resnum F125 .or. -
   atom @ligseg @resnum F126 .or. -
   none ) end

define site1_sub8 - 
   select ( - 
   atom @ligseg @resnum C127 .or. -
   atom @ligseg @resnum H128 .or. -
   atom @ligseg @resnum C129 .or. -
   atom @ligseg @resnum H130 .or. -
   atom @ligseg @resnum C131 .or. -
   atom @ligseg @resnum C132 .or. -
   atom @ligseg @resnum H133 .or. -
   atom @ligseg @resnum C134 .or. -
   atom @ligseg @resnum H135 .or. -
   atom @ligseg @resnum O136 .or. -
   atom @ligseg @resnum C137 .or. -
   atom @ligseg @resnum H138 .or. -
   atom @ligseg @resnum H139 .or. -
   atom @ligseg @resnum H140 .or. -
   none ) end

define site1_sub9 - 
   select ( - 
   atom @ligseg @resnum C141 .or. -
   atom @ligseg @resnum H142 .or. -
   atom @ligseg @resnum C143 .or. -
   atom @ligseg @resnum H144 .or. -
   atom @ligseg @resnum C145 .or. -
   atom @ligseg @resnum C146 .or. -
   atom @ligseg @resnum H147 .or. -
   atom @ligseg @resnum C148 .or. -
   atom @ligseg @resnum H149 .or. -
   atom @ligseg @resnum O150 .or. -
   atom @ligseg @resnum C151 .or. -
   atom @ligseg @resnum H152 .or. -
   atom @ligseg @resnum H153 .or. -
   atom @ligseg @resnum C154 .or. -
   atom @ligseg @resnum H155 .or. -
   atom @ligseg @resnum H156 .or. -
   atom @ligseg @resnum H157 .or. -
   none ) end

define site1_sub10 - 
   select ( - 
   atom @ligseg @resnum C158 .or. -
   atom @ligseg @resnum H159 .or. -
   atom @ligseg @resnum C160 .or. -
   atom @ligseg @resnum H161 .or. -
   atom @ligseg @resnum C162 .or. -
   atom @ligseg @resnum C163 .or. -
   atom @ligseg @resnum H164 .or. -
   atom @ligseg @resnum C165 .or. -
   atom @ligseg @resnum H166 .or. -
   atom @ligseg @resnum O167 .or. -
   atom @ligseg @resnum C168 .or. -
   atom @ligseg @resnum H169 .or. -
   atom @ligseg @resnum H170 .or. -
   atom @ligseg @resnum C171 .or. -
   atom @ligseg @resnum F172 .or. -
   atom @ligseg @resnum F173 .or. -
   atom @ligseg @resnum F174 .or. -
   none ) end

define site1_sub11 - 
   select ( - 
   atom @ligseg @resnum C175 .or. -
   atom @ligseg @resnum H176 .or. -
   atom @ligseg @resnum C177 .or. -
   atom @ligseg @resnum H178 .or. -
   atom @ligseg @resnum C179 .or. -
   atom @ligseg @resnum C180 .or. -
   atom @ligseg @resnum H181 .or. -
   atom @ligseg @resnum C182 .or. -
   atom @ligseg @resnum H183 .or. -
   atom @ligseg @resnum S184 .or. -
   atom @ligseg @resnum C185 .or. -
   atom @ligseg @resnum H186 .or. -
   atom @ligseg @resnum H187 .or. -
   atom @ligseg @resnum H188 .or. -
   none ) end

define site1_sub12 - 
   select ( - 
   atom @ligseg @resnum C189 .or. -
   atom @ligseg @resnum H190 .or. -
   atom @ligseg @resnum C191 .or. -
   atom @ligseg @resnum H192 .or. -
   atom @ligseg @resnum C193 .or. -
   atom @ligseg @resnum C194 .or. -
   atom @ligseg @resnum H195 .or. -
   atom @ligseg @resnum C196 .or. -
   atom @ligseg @resnum H197 .or. -
   atom @ligseg @resnum S198 .or. -
   atom @ligseg @resnum C199 .or. -
   atom @ligseg @resnum H200 .or. -
   atom @ligseg @resnum H201 .or. -
   atom @ligseg @resnum C202 .or. -
   atom @ligseg @resnum H203 .or. -
   atom @ligseg @resnum H204 .or. -
   atom @ligseg @resnum H205 .or. -
   none ) end

define site1_sub13 - 
   select ( - 
   atom @ligseg @resnum C206 .or. -
   atom @ligseg @resnum H207 .or. -
   atom @ligseg @resnum C208 .or. -
   atom @ligseg @resnum H209 .or. -
   atom @ligseg @resnum C210 .or. -
   atom @ligseg @resnum C211 .or. -
   atom @ligseg @resnum H212 .or. -
   atom @ligseg @resnum C213 .or. -
   atom @ligseg @resnum H214 .or. -
   atom @ligseg @resnum S215 .or. -
   atom @ligseg @resnum C216 .or. -
   atom @ligseg @resnum F217 .or. -
   atom @ligseg @resnum F218 .or. -
   atom @ligseg @resnum F219 .or. -
   none ) end

define site1_sub14 - 
   select ( - 
   atom @ligseg @resnum C220 .or. -
   atom @ligseg @resnum H221 .or. -
   atom @ligseg @resnum C222 .or. -
   atom @ligseg @resnum H223 .or. -
   atom @ligseg @resnum C224 .or. -
   atom @ligseg @resnum C225 .or. -
   atom @ligseg @resnum H226 .or. -
   atom @ligseg @resnum C227 .or. -
   atom @ligseg @resnum H228 .or. -
   atom @ligseg @resnum Cl0C .or. -
   atom @ligseg @resnum LP0D .or. -
   none ) end

define site1_sub15 - 
   select ( - 
   atom @ligseg @resnum C229 .or. -
   atom @ligseg @resnum H230 .or. -
   atom @ligseg @resnum C231 .or. -
   atom @ligseg @resnum H232 .or. -
   atom @ligseg @resnum C233 .or. -
   atom @ligseg @resnum C234 .or. -
   atom @ligseg @resnum H235 .or. -
   atom @ligseg @resnum C236 .or. -
   atom @ligseg @resnum H237 .or. -
   atom @ligseg @resnum F238 .or. -
   none ) end

define site1_sub16 - 
   select ( - 
   atom @ligseg @resnum C239 .or. -
   atom @ligseg @resnum H240 .or. -
   atom @ligseg @resnum C241 .or. -
   atom @ligseg @resnum H242 .or. -
   atom @ligseg @resnum C243 .or. -
   atom @ligseg @resnum C244 .or. -
   atom @ligseg @resnum H245 .or. -
   atom @ligseg @resnum C246 .or. -
   atom @ligseg @resnum H247 .or. -
   atom @ligseg @resnum C248 .or. -
   atom @ligseg @resnum N249 .or. -
   none ) end

define site1_sub17 - 
   select ( - 
   atom @ligseg @resnum C250 .or. -
   atom @ligseg @resnum H251 .or. -
   atom @ligseg @resnum C252 .or. -
   atom @ligseg @resnum H253 .or. -
   atom @ligseg @resnum C254 .or. -
   atom @ligseg @resnum H255 .or. -
   atom @ligseg @resnum C256 .or. -
   atom @ligseg @resnum C257 .or. -
   atom @ligseg @resnum H258 .or. -
   atom @ligseg @resnum C259 .or. -
   atom @ligseg @resnum H260 .or. -
   atom @ligseg @resnum H261 .or. -
   atom @ligseg @resnum H262 .or. -
   none ) end

define site1_sub18 - 
   select ( - 
   atom @ligseg @resnum C263 .or. -
   atom @ligseg @resnum H264 .or. -
   atom @ligseg @resnum C265 .or. -
   atom @ligseg @resnum H266 .or. -
   atom @ligseg @resnum C267 .or. -
   atom @ligseg @resnum H268 .or. -
   atom @ligseg @resnum C269 .or. -
   atom @ligseg @resnum C270 .or. -
   atom @ligseg @resnum H271 .or. -
   atom @ligseg @resnum Cl0E .or. -
   atom @ligseg @resnum LP0F .or. -
   none ) end

define site1_sub19 - 
   select ( - 
   atom @ligseg @resnum C272 .or. -
   atom @ligseg @resnum H273 .or. -
   atom @ligseg @resnum C274 .or. -
   atom @ligseg @resnum H275 .or. -
   atom @ligseg @resnum C276 .or. -
   atom @ligseg @resnum H277 .or. -
   atom @ligseg @resnum C278 .or. -
   atom @ligseg @resnum C279 .or. -
   atom @ligseg @resnum H280 .or. -
   atom @ligseg @resnum C281 .or. -
   atom @ligseg @resnum F282 .or. -
   atom @ligseg @resnum F283 .or. -
   atom @ligseg @resnum F284 .or. -
   none ) end

define site1_sub20 - 
   select ( - 
   atom @ligseg @resnum C285 .or. -
   atom @ligseg @resnum H286 .or. -
   atom @ligseg @resnum C287 .or. -
   atom @ligseg @resnum H288 .or. -
   atom @ligseg @resnum C289 .or. -
   atom @ligseg @resnum H290 .or. -
   atom @ligseg @resnum C291 .or. -
   atom @ligseg @resnum C292 .or. -
   atom @ligseg @resnum H293 .or. -
   atom @ligseg @resnum O294 .or. -
   atom @ligseg @resnum C295 .or. -
   atom @ligseg @resnum H296 .or. -
   atom @ligseg @resnum H297 .or. -
   atom @ligseg @resnum H298 .or. -
   none ) end

define site1_sub21 - 
   select ( - 
   atom @ligseg @resnum C299 .or. -
   atom @ligseg @resnum C300 .or. -
   atom @ligseg @resnum H301 .or. -
   atom @ligseg @resnum C302 .or. -
   atom @ligseg @resnum H303 .or. -
   atom @ligseg @resnum C304 .or. -
   atom @ligseg @resnum H305 .or. -
   atom @ligseg @resnum C306 .or. -
   atom @ligseg @resnum H307 .or. -
   atom @ligseg @resnum C308 .or. -
   atom @ligseg @resnum H309 .or. -
   atom @ligseg @resnum H310 .or. -
   atom @ligseg @resnum H311 .or. -
   none ) end

define site1_sub22 - 
   select ( - 
   atom @ligseg @resnum C312 .or. -
   atom @ligseg @resnum H313 .or. -
   atom @ligseg @resnum C314 .or. -
   atom @ligseg @resnum H315 .or. -
   atom @ligseg @resnum C316 .or. -
   atom @ligseg @resnum C317 .or. -
   atom @ligseg @resnum C318 .or. -
   atom @ligseg @resnum H319 .or. -
   atom @ligseg @resnum H320 .or. -
   atom @ligseg @resnum H321 .or. -
   atom @ligseg @resnum C322 .or. -
   atom @ligseg @resnum H323 .or. -
   atom @ligseg @resnum C324 .or. -
   atom @ligseg @resnum H325 .or. -
   atom @ligseg @resnum H326 .or. -
   atom @ligseg @resnum H327 .or. -
   none ) end

define site1_sub23 - 
   select ( - 
   atom @ligseg @resnum C328 .or. -
   atom @ligseg @resnum H329 .or. -
   atom @ligseg @resnum C330 .or. -
   atom @ligseg @resnum H331 .or. -
   atom @ligseg @resnum C332 .or. -
   atom @ligseg @resnum C333 .or. -
   atom @ligseg @resnum C334 .or. -
   atom @ligseg @resnum H335 .or. -
   atom @ligseg @resnum H336 .or. -
   atom @ligseg @resnum H337 .or. -
   atom @ligseg @resnum C338 .or. -
   atom @ligseg @resnum H339 .or. -
   atom @ligseg @resnum O340 .or. -
   atom @ligseg @resnum C341 .or. -
   atom @ligseg @resnum H342 .or. -
   atom @ligseg @resnum H343 .or. -
   atom @ligseg @resnum H344 .or. -
   none ) end

define site1_sub24 - 
   select ( - 
   atom @ligseg @resnum C345 .or. -
   atom @ligseg @resnum H346 .or. -
   atom @ligseg @resnum C347 .or. -
   atom @ligseg @resnum H348 .or. -
   atom @ligseg @resnum C349 .or. -
   atom @ligseg @resnum C350 .or. -
   atom @ligseg @resnum C351 .or. -
   atom @ligseg @resnum H352 .or. -
   atom @ligseg @resnum F353 .or. -
   atom @ligseg @resnum O354 .or. -
   atom @ligseg @resnum C355 .or. -
   atom @ligseg @resnum F356 .or. -
   atom @ligseg @resnum F357 .or. -
   atom @ligseg @resnum F358 .or. -
   none ) end

define site1_sub25 - 
   select ( - 
   atom @ligseg @resnum C359 .or. -
   atom @ligseg @resnum H360 .or. -
   atom @ligseg @resnum C361 .or. -
   atom @ligseg @resnum H362 .or. -
   atom @ligseg @resnum C363 .or. -
   atom @ligseg @resnum C364 .or. -
   atom @ligseg @resnum C365 .or. -
   atom @ligseg @resnum F366 .or. -
   atom @ligseg @resnum F367 .or. -
   atom @ligseg @resnum F368 .or. -
   atom @ligseg @resnum C369 .or. -
   atom @ligseg @resnum H370 .or. -
   atom @ligseg @resnum O371 .or. -
   atom @ligseg @resnum C372 .or. -
   atom @ligseg @resnum H373 .or. -
   atom @ligseg @resnum H374 .or. -
   atom @ligseg @resnum C375 .or. -
   atom @ligseg @resnum H376 .or. -
   atom @ligseg @resnum H377 .or. -
   atom @ligseg @resnum H378 .or. -
   none ) end

define site1_sub26 - 
   select ( - 
   atom @ligseg @resnum C379 .or. -
   atom @ligseg @resnum H380 .or. -
   atom @ligseg @resnum C381 .or. -
   atom @ligseg @resnum H382 .or. -
   atom @ligseg @resnum C383 .or. -
   atom @ligseg @resnum C384 .or. -
   atom @ligseg @resnum Cl0G .or. -
   atom @ligseg @resnum C385 .or. -
   atom @ligseg @resnum H386 .or. -
   atom @ligseg @resnum O387 .or. -
   atom @ligseg @resnum C388 .or. -
   atom @ligseg @resnum H389 .or. -
   atom @ligseg @resnum H390 .or. -
   atom @ligseg @resnum C391 .or. -
   atom @ligseg @resnum H392 .or. -
   atom @ligseg @resnum H393 .or. -
   atom @ligseg @resnum H394 .or. -
   atom @ligseg @resnum LP0H .or. -
   none ) end

define site1_sub27 - 
   select ( - 
   atom @ligseg @resnum C395 .or. -
   atom @ligseg @resnum H396 .or. -
   atom @ligseg @resnum C397 .or. -
   atom @ligseg @resnum H398 .or. -
   atom @ligseg @resnum C399 .or. -
   atom @ligseg @resnum C400 .or. -
   atom @ligseg @resnum F401 .or. -
   atom @ligseg @resnum C402 .or. -
   atom @ligseg @resnum H403 .or. -
   atom @ligseg @resnum O404 .or. -
   atom @ligseg @resnum C405 .or. -
   atom @ligseg @resnum H406 .or. -
   atom @ligseg @resnum H407 .or. -
   atom @ligseg @resnum C408 .or. -
   atom @ligseg @resnum H409 .or. -
   atom @ligseg @resnum H410 .or. -
   atom @ligseg @resnum H411 .or. -
   none ) end

define site1_sub28 - 
   select ( - 
   atom @ligseg @resnum C412 .or. -
   atom @ligseg @resnum H413 .or. -
   atom @ligseg @resnum C414 .or. -
   atom @ligseg @resnum H415 .or. -
   atom @ligseg @resnum C416 .or. -
   atom @ligseg @resnum C417 .or. -
   atom @ligseg @resnum C418 .or. -
   atom @ligseg @resnum H419 .or. -
   atom @ligseg @resnum F420 .or. -
   atom @ligseg @resnum O421 .or. -
   atom @ligseg @resnum C422 .or. -
   atom @ligseg @resnum H423 .or. -
   atom @ligseg @resnum H424 .or. -
   atom @ligseg @resnum C425 .or. -
   atom @ligseg @resnum F426 .or. -
   atom @ligseg @resnum F427 .or. -
   atom @ligseg @resnum F428 .or. -
   none ) end

define site1_sub29 - 
   select ( - 
   atom @ligseg @resnum C429 .or. -
   atom @ligseg @resnum H430 .or. -
   atom @ligseg @resnum C431 .or. -
   atom @ligseg @resnum H432 .or. -
   atom @ligseg @resnum C433 .or. -
   atom @ligseg @resnum C434 .or. -
   atom @ligseg @resnum F435 .or. -
   atom @ligseg @resnum C436 .or. -
   atom @ligseg @resnum H437 .or. -
   atom @ligseg @resnum C438 .or. -
   atom @ligseg @resnum O439 .or. -
   atom @ligseg @resnum C440 .or. -
   atom @ligseg @resnum H441 .or. -
   atom @ligseg @resnum H442 .or. -
   atom @ligseg @resnum H443 .or. -
   none ) end

define site1_sub30 - 
   select ( - 
   atom @ligseg @resnum C444 .or. -
   atom @ligseg @resnum H445 .or. -
   atom @ligseg @resnum C446 .or. -
   atom @ligseg @resnum H447 .or. -
   atom @ligseg @resnum C448 .or. -
   atom @ligseg @resnum C449 .or. -
   atom @ligseg @resnum C450 .or. -
   atom @ligseg @resnum H451 .or. -
   atom @ligseg @resnum F452 .or. -
   atom @ligseg @resnum C453 .or. -
   atom @ligseg @resnum F454 .or. -
   atom @ligseg @resnum F455 .or. -
   atom @ligseg @resnum F456 .or. -
   none ) end

define site1_sub31 - 
   select ( - 
   atom @ligseg @resnum C457 .or. -
   atom @ligseg @resnum H458 .or. -
   atom @ligseg @resnum C459 .or. -
   atom @ligseg @resnum H460 .or. -
   atom @ligseg @resnum C461 .or. -
   atom @ligseg @resnum C462 .or. -
   atom @ligseg @resnum C463 .or. -
   atom @ligseg @resnum H464 .or. -
   atom @ligseg @resnum C465 .or. -
   atom @ligseg @resnum F466 .or. -
   atom @ligseg @resnum F467 .or. -
   atom @ligseg @resnum F468 .or. -
   atom @ligseg @resnum Cl0I .or. -
   atom @ligseg @resnum LP0J .or. -
   none ) end

define site1_sub32 - 
   select ( - 
   atom @ligseg @resnum C469 .or. -
   atom @ligseg @resnum H470 .or. -
   atom @ligseg @resnum C471 .or. -
   atom @ligseg @resnum H472 .or. -
   atom @ligseg @resnum C473 .or. -
   atom @ligseg @resnum C474 .or. -
   atom @ligseg @resnum H475 .or. -
   atom @ligseg @resnum C476 .or. -
   atom @ligseg @resnum H477 .or. -
   atom @ligseg @resnum O478 .or. -
   atom @ligseg @resnum C479 .or. -
   atom @ligseg @resnum F480 .or. -
   atom @ligseg @resnum F481 .or. -
   atom @ligseg @resnum F482 .or. -
   none ) end

define site2_sub1 - 
   select ( - 
   atom @ligseg @resnum C483 .or. -
   atom @ligseg @resnum H484 .or. -
   atom @ligseg @resnum C485 .or. -
   atom @ligseg @resnum H486 .or. -
   atom @ligseg @resnum C487 .or. -
   atom @ligseg @resnum H488 .or. -
   atom @ligseg @resnum C489 .or. -
   atom @ligseg @resnum H490 .or. -
   none ) end

auto angle dihe  !! do not call after deleting sub-sub terms or loading in water
bomblev -1

! delete angles and dihedrals between alchem groups
set ii = 1
label deletesiteloop
if @ii .le. @nsites then

   set jj = 1
   label delete1loop
   if @jj .le. @nsubs@@ii then

      calc kk = @jj + 1
      label delete2loop
      if @kk .le. @nsubs@@ii then

         dele connectivity sele ( site@{ii}_sub@@jj ) show end sele ( site@{ii}_sub@@kk ) show end
         calc kk = @kk + 1
         goto delete2loop
      endif

      calc jj = @jj + 1
      goto delete1loop
   endif

   calc ii = @ii + 1
   goto deletesiteloop
endif

!! ! System specific deletion (linear groups)
!! dele dihe sele (atom LIG 1 ATOMNAME) show end

!! Load solvent
read sequ pdb name @builddir/solvent.pdb
generate WT00 first none last none setup noangl nodihe
read coor pdb resid name @builddir/solvent.pdb

!! !! Load ions
!! read sequ pdb name @builddir/ions.pdb
!! generate HETA first none last none setup noangl nodihe
!! read coor pdb resid name @builddir/ions.pdb

print coor sele .not. init end

bomblev 0

!! !! Write Initial System to Disk
!! write psf card name patch.psf
!! * patch psf file
!! *
!! write coor pdb card name patch.pdb
!! * patch pdb file
!! *
!! write coor card name patch.crd
!! * patch crd file
!! *

!! Create water box & periodic images
coor stat
crystal define cubic @box @box @box 90. 90. 90.
crystal build cutoff 14 nope 0
image byres xcen 0 ycen 0 zcen 0 sele resn tip3 .or. resn sod .or. resn cla end
image byseg xcen 0 ycen 0 zcen 0 sele .not. ( resn tip3 .or. resn sod .or. resn cla ) end

!! Copy main coords into comp set
cons harm clear
coor copy comp

! LDBI math: for every "pair" there are 5 ldbi's
set ii = 1
set ldbibias = 0
label ldbimathloop
if @ii .le. @nsites then
   calc ldbibias = @ldbibias + ( ( @nsubs@@ii * (@nsubs@@ii - 1) / 2 ) * 5 )
   INCR ii by 1
   goto ldbimathloop
endif
set charge = ?cgtot

calc blockplusone = @nblocks + 1

!! BLOCK setup
BLOCK @blockplusone
   clear
END
BLOCK @blockplusone !RX! NREP @nreps
   Call 2 sele site1_sub1 show end
   Call 3 sele site1_sub2 show end
   Call 4 sele site1_sub3 show end
   Call 5 sele site1_sub4 show end
   Call 6 sele site1_sub5 show end
   Call 7 sele site1_sub6 show end
   Call 8 sele site1_sub7 show end
   Call 9 sele site1_sub8 show end
   Call 10 sele site1_sub9 show end
   Call 11 sele site1_sub10 show end
   Call 12 sele site1_sub11 show end
   Call 13 sele site1_sub12 show end
   Call 14 sele site1_sub13 show end
   Call 15 sele site1_sub14 show end
   Call 16 sele site1_sub15 show end
   Call 17 sele site1_sub16 show end
   Call 18 sele site1_sub17 show end
   Call 19 sele site1_sub18 show end
   Call 20 sele site1_sub19 show end
   Call 21 sele site1_sub20 show end
   Call 22 sele site1_sub21 show end
   Call 23 sele site1_sub22 show end
   Call 24 sele site1_sub23 show end
   Call 25 sele site1_sub24 show end
   Call 26 sele site1_sub25 show end
   Call 27 sele site1_sub26 show end
   Call 28 sele site1_sub27 show end
   Call 29 sele site1_sub28 show end
   Call 30 sele site1_sub29 show end
   Call 31 sele site1_sub30 show end
   Call 32 sele site1_sub31 show end
   Call 33 sele site1_sub32 show end
   Call 34 sele site2_sub1 show end

   qldm theta
   lang temp @temp
   !RX! phmd ph 7
   soft on   ! this turns on soft-cores
   pmel ex   ! this turns on PME

   ldin 1 1.0  0.0  5.0  0.0  5.0
   ldin 2  0.0312 0.0  5.0  @lams1s1 5.0 !RX! NONE
   ldin 3  0.0312 0.0  5.0  @lams1s2 5.0 !RX! UNEG 7.0
   ldin 4  0.0312 0.0  5.0  @lams1s3 5.0 !RX! UPOS 7.0
   ldin 5  0.0312 0.0  5.0  @lams1s4 5.0 !RX! UNEG 7.0
   ldin 6  0.0312 0.0  5.0  @lams1s5 5.0 !RX! UPOS 7.0
   ldin 7  0.0312 0.0  5.0  @lams1s6 5.0 !RX! UNEG 7.0
   ldin 8  0.0312 0.0  5.0  @lams1s7 5.0 !RX! UPOS 7.0
   ldin 9  0.0312 0.0  5.0  @lams1s8 5.0 !RX! UNEG 7.0
   ldin 10 0.0312 0.0  5.0  @lams1s9 5.0 !RX! UPOS 7.0
   ldin 11 0.0312 0.0  5.0  @lams1s10 5.0 !RX! UNEG 7.0
   ldin 12 0.0312 0.0  5.0  @lams1s11 5.0 !RX! UPOS 7.0
   ldin 13 0.0312 0.0  5.0  @lams1s12 5.0 !RX! UNEG 7.0
   ldin 14 0.0312 0.0  5.0  @lams1s13 5.0 !RX! UPOS 7.0
   ldin 15 0.0312 0.0  5.0  @lams1s14 5.0 !RX! UNEG 7.0
   ldin 16 0.0312 0.0  5.0  @lams1s15 5.0 !RX! UPOS 7.0
   ldin 17 0.0312 0.0  5.0  @lams1s16 5.0 !RX! UNEG 7.0
   ldin 18 0.0312 0.0  5.0  @lams1s17 5.0 !RX! UPOS 7.0
   ldin 19 0.0312 0.0  5.0  @lams1s18 5.0 !RX! UNEG 7.0
   ldin 20 0.0312 0.0  5.0  @lams1s19 5.0 !RX! UPOS 7.0
   ldin 21 0.0312 0.0  5.0  @lams1s20 5.0 !RX! UNEG 7.0
   ldin 22 0.0312 0.0  5.0  @lams1s21 5.0 !RX! UPOS 7.0
   ldin 23 0.0312 0.0  5.0  @lams1s22 5.0 !RX! UNEG 7.0
   ldin 24 0.0312 0.0  5.0  @lams1s23 5.0 !RX! UPOS 7.0
   ldin 25 0.0312 0.0  5.0  @lams1s24 5.0 !RX! UNEG 7.0
   ldin 26 0.0312 0.0  5.0  @lams1s25 5.0 !RX! UPOS 7.0
   ldin 27 0.0312 0.0  5.0  @lams1s26 5.0 !RX! UNEG 7.0
   ldin 28 0.0312 0.0  5.0  @lams1s27 5.0 !RX! UPOS 7.0
   ldin 29 0.0312 0.0  5.0  @lams1s28 5.0 !RX! UNEG 7.0
   ldin 30 0.0312 0.0  5.0  @lams1s29 5.0 !RX! UPOS 7.0
   ldin 31 0.0312 0.0  5.0  @lams1s30 5.0 !RX! UNEG 7.0
   ldin 32 0.0312 0.0  5.0  @lams1s31 5.0 !RX! UPOS 7.0
   ldin 33 0.0312 0.0  5.0  @lams1s32 5.0 !RX! UNEG 7.0
   ldin 34 1.0000 0.0  5.0  @lams2s1 5.0 !RX! NONE

   set excl1 = 2 3 2 4 2 5 2 6 2 7 2 8 2 9 2 10 2 11 2 12 2 13
   set excl2 = 2 14 2 15 2 16 2 17 2 18 2 19 2 20 2 21 2 22 2 23 2 24
   set excl3 = 2 25 2 26 2 27 2 28 2 29 2 30 2 31 2 32 2 33 3 4 3 5
   set excl4 = 3 6 3 7 3 8 3 9 3 10 3 11 3 12 3 13 3 14 3 15 3 16
   set excl5 = 3 17 3 18 3 19 3 20 3 21 3 22 3 23 3 24 3 25 3 26 3 27
   set excl6 = 3 28 3 29 3 30 3 31 3 32 3 33 4 5 4 6 4 7 4 8 4 9
   set excl7 = 4 10 4 11 4 12 4 13 4 14 4 15 4 16 4 17 4 18 4 19 4 20
   set excl8 = 4 21 4 22 4 23 4 24 4 25 4 26 4 27 4 28 4 29 4 30 4 31
   set excl9 = 4 32 4 33 5 6 5 7 5 8 5 9 5 10 5 11 5 12 5 13 5 14
   set excl10 = 5 15 5 16 5 17 5 18 5 19 5 20 5 21 5 22 5 23 5 24 5 25
   set excl11 = 5 26 5 27 5 28 5 29 5 30 5 31 5 32 5 33 6 7 6 8 6 9
   set excl12 = 6 10 6 11 6 12 6 13 6 14 6 15 6 16 6 17 6 18 6 19 6 20
   set excl13 = 6 21 6 22 6 23 6 24 6 25 6 26 6 27 6 28 6 29 6 30 6 31
   set excl14 = 6 32 6 33 7 8 7 9 7 10 7 11 7 12 7 13 7 14 7 15 7 16
   set excl15 = 7 17 7 18 7 19 7 20 7 21 7 22 7 23 7 24 7 25 7 26 7 27
   set excl16 = 7 28 7 29 7 30 7 31 7 32 7 33 8 9 8 10 8 11 8 12 8 13
   set excl17 = 8 14 8 15 8 16 8 17 8 18 8 19 8 20 8 21 8 22 8 23 8 24
   set excl18 = 8 25 8 26 8 27 8 28 8 29 8 30 8 31 8 32 8 33 9 10 9 11
   set excl19 = 9 12 9 13 9 14 9 15 9 16 9 17 9 18 9 19 9 20 9 21 9 22
   set excl20 = 9 23 9 24 9 25 9 26 9 27 9 28 9 29 9 30 9 31 9 32 9 33
   set excl21 = 10 11 10 12 10 13 10 14 10 15 10 16 10 17 10 18 10 19 10 20 10 21
   set excl22 = 10 22 10 23 10 24 10 25 10 26 10 27 10 28 10 29 10 30 10 31 10 32
   set excl23 = 10 33 11 12 11 13 11 14 11 15 11 16 11 17 11 18 11 19 11 20 11 21
   set excl24 = 11 22 11 23 11 24 11 25 11 26 11 27 11 28 11 29 11 30 11 31 11 32
   set excl25 = 11 33 12 13 12 14 12 15 12 16 12 17 12 18 12 19 12 20 12 21 12 22
   set excl26 = 12 23 12 24 12 25 12 26 12 27 12 28 12 29 12 30 12 31 12 32 12 33
   set excl27 = 13 14 13 15 13 16 13 17 13 18 13 19 13 20 13 21 13 22 13 23 13 24
   set excl28 = 13 25 13 26 13 27 13 28 13 29 13 30 13 31 13 32 13 33 14 15 14 16
   set excl29 = 14 17 14 18 14 19 14 20 14 21 14 22 14 23 14 24 14 25 14 26 14 27
   set excl30 = 14 28 14 29 14 30 14 31 14 32 14 33 15 16 15 17 15 18 15 19 15 20
   set excl31 = 15 21 15 22 15 23 15 24 15 25 15 26 15 27 15 28 15 29 15 30 15 31
   set excl32 = 15 32 15 33 16 17 16 18 16 19 16 20 16 21 16 22 16 23 16 24 16 25
   set excl33 = 16 26 16 27 16 28 16 29 16 30 16 31 16 32 16 33 17 18 17 19 17 20
   set excl34 = 17 21 17 22 17 23 17 24 17 25 17 26 17 27 17 28 17 29 17 30 17 31
   set excl35 = 17 32 17 33 18 19 18 20 18 21 18 22 18 23 18 24 18 25 18 26 18 27
   set excl36 = 18 28 18 29 18 30 18 31 18 32 18 33 19 20 19 21 19 22 19 23 19 24
   set excl37 = 19 25 19 26 19 27 19 28 19 29 19 30 19 31 19 32 19 33 20 21 20 22
   set excl38 = 20 23 20 24 20 25 20 26 20 27 20 28 20 29 20 30 20 31 20 32 20 33
   set excl39 = 21 22 21 23 21 24 21 25 21 26 21 27 21 28 21 29 21 30 21 31 21 32
   set excl40 = 21 33 22 23 22 24 22 25 22 26 22 27 22 28 22 29 22 30 22 31 22 32
   set excl41 = 22 33 23 24 23 25 23 26 23 27 23 28 23 29 23 30 23 31 23 32 23 33
   set excl42 = 24 25 24 26 24 27 24 28 24 29 24 30 24 31 24 32 24 33 25 26 25 27
   set excl43 = 25 28 25 29 25 30 25 31 25 32 25 33 26 27 26 28 26 29 26 30 26 31
   set excl44 = 26 32 26 33 27 28 27 29 27 30 27 31 27 32 27 33 28 29 28 30 28 31
   set excl45 = 28 32 28 33 29 30 29 31 29 32 29 33 30 31 30 32 30 33 31 32 31 33
   set excl46 = 32 33
   excl @excl1 @excl2 @excl3 @excl4 @excl5 @excl6 @excl7 @excl8 @excl9 @excl10 @excl11 @excl12 @excl13 @excl14 @excl15 @excl16 @excl17 @excl18 @excl19 @excl20 @excl21 @excl22 @excl23 @excl24 @excl25 @excl26 @excl27 @excl28 @excl29 @excl30 @excl31 @excl32 @excl33 @excl34 @excl35 @excl36 @excl37 @excl38 @excl39 @excl40 @excl41 @excl42 @excl43 @excl44 @excl45 @excl46

   !!rmla bond thet dihe impr 
   rmla bond thet impr 
   msld 0  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  2  fnex @fnex
   msma

   ! Check block.doc for functional form of these biasing potentials
   calc nbiaspot = 5 * ( @nblocks * ( @nblocks - 1 ) ) / 2
   ldbi @nbiaspot
   set ibias = 1
   set iblock = 0
   set si = 1
   label loop5_vb
   if @si .le. @nsites then
      set jblock = @iblock
      set sj = @si
      label loop5b_vb
      if @sj .le. @nsites then
         set ii = 1
         label loop6_vb
         if @ii .le. @nsubs@@{si} then
            calc ip1 = @ii + 1 + @iblock
            set jj = 1
            if @si .eq. @sj then
               calc jj = @ii + 1
            endif
            label loop7_vb
            if @jj .le. @nsubs@@{sj} then
               calc jp1 = @jj + 1 + @jblock
   
               set c_shift = 0.0
               set x_shift = 0.0
               set s_shift = 0.0
               !vbrex! if @si .eq. @sj then
               !vbrex!    calc c_shift = 1.2 * (@myrep - @ncentral)
               !vbrex!    calc s_shift = 0.3 * (@myrep - @ncentral)
               !vbrex! endif
   
               calc coeff = @cs@@{si}s@@{ii}s@@{sj}s@@{jj} + @{c_shift}
               ldbv @ibias @ip1 @jp1 6 0.0 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @xs@@{si}s@@{ii}s@@{sj}s@@{jj} + @{x_shift}
               ldbv @ibias @ip1 @jp1 10 -5.56 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @ss@@{si}s@@{ii}s@@{sj}s@@{jj} + @{s_shift}
               ldbv @ibias @ip1 @jp1 8 0.017 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @xs@@{sj}s@@{jj}s@@{si}s@@{ii} + @{x_shift}
               ldbv @ibias @jp1 @ip1 10 -5.56 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @ss@@{sj}s@@{jj}s@@{si}s@@{ii} + @{s_shift}
               ldbv @ibias @jp1 @ip1 8 0.017 @coeff 0
               calc ibias = @ibias + 1
               calc jj = @jj + 1
               goto loop7_vb
            endif
            calc ii = @ii + 1
            goto loop6_vb
         endif
         calc jblock = @jblock + @nsubs@@{sj}
         calc sj = @sj + 1
         goto loop5b_vb
      endif
      calc iblock = @iblock + @nsubs@@{si}
      calc si = @si + 1
      goto loop5_vb
   endif
END

!! !! Set NOE distance restraints
!! NOE
!!    RESET
!! END
!! 
!! faster on
!! !! set up energy parameters if you want to use NOEs
!! nbonds atom fswitch vdw vfswitch cdie eps 1 -
!!     cutnb 14.0 cutim 14.0 ctonnb 10.0 ctofnb 12.0

!! energy
!! NOE
!! ! Site 1
!!    assign sele atom LIG 1 Atom1 end sele atom LIG 1 Atom2 end -
!!    kmin 1.0 rmin 0.0 kmax 1.0 rmax 0.2 fmax 2.0 rswitch 2.0 sexp 1.0
!! ! Site 2
!! 
!!    print anal
!! END


